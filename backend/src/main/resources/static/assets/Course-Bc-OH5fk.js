import{_ as ae,r,a as z,c as le,o as te,d as F,e as y,f as a,w as s,y as oe,z as V,A as se,m as l,i as re,j as C,k as ue,T as N,U as d,K as ne,L as de,x as f,V as ie,v as g,B as ce,C as me,F as k,D as pe,aL as fe,aM as ge,G as ve,H as ye,a2 as Ce,h as L,aN as be,g as _e,N as we,P as i,af as Ee}from"./index-D-KotFfR.js";/* empty css                        */import{f as he,d as Te,u as Ve,e as Ne}from"./course-DKE-dNb-.js";import{f as ke}from"./user-CzFfBPdz.js";import{g as Le}from"./term-QB43cPel.js";import{C as Ie}from"./CourseForm-W1_CZKu4.js";import"./request-D0VF7A5d.js";import"./common-BBGhIV1Q.js";const xe={class:"course-management"},ze={class:"header"},Fe={class:"dialog-footer"},Ue={name:"CourseManagement"},Be=Object.assign(Ue,{setup(Se){const E=r(!1),I=r([]),h=r(0),m=r(1),b=r(10),u=z({keyword:"",status:null,termId:null}),p=r(!1),x=r("添加课程"),_=r(null),v=r({id:null,courseNo:"",courseName:"",credit:0,courseType:null,collegeId:null,collegeName:"",introduction:"",status:1});z({courseNo:[{required:!0,message:"请输入课程代码",trigger:"blur"}],courseName:[{required:!0,message:"请输入课程名称",trigger:"blur"}],credit:[{required:!0,message:"请输入学分",trigger:"blur"},{type:"number",message:"学分必须为数字值"},{validator:(t,e,n)=>{e<0?n(new Error("学分不能为负数")):n()},trigger:"blur"}]});const w=le(()=>!!v.value.id),U=r([]),B=r([]),S=r([]),M=r(!1),D=r(!1),P=r({}),c=async()=>{E.value=!0;try{const t={page:m.value,size:b.value,keyword:u.keyword||void 0,status:u.status,termId:u.termId||void 0},e=await he(t);I.value=e.data.records||[],h.value=e.data.total||0}catch(t){console.error("获取课程列表失败",t),i.error("获取课程列表失败")}finally{E.value=!1}},O=async()=>{try{const t=await ke({userType:"Teacher"});U.value=t.data||[]}catch(t){console.error("获取教师列表失败",t)}},R=async()=>{try{const t=await Le();if(t.code===200&&t.data){B.value=t.data;const e=t.data.find(n=>n.current===1);e&&!u.termId&&(u.termId=e.id,c())}else i.error(t.message||"获取学期列表失败")}catch(t){console.error("获取学期列表失败",t),i.error("获取学期列表时发生错误")}},A=()=>{m.value=1,c()},$=t=>{b.value=t,m.value=1,c()},j=t=>{m.value=t,c()},T=()=>{_.value&&_.value.resetFields(),v.value={id:null,courseNo:"",courseName:"",credit:0,courseType:null,collegeId:null,collegeName:"",introduction:"",status:1}},q=()=>{T(),x.value="添加课程",p.value=!0},G=t=>{T(),x.value="编辑课程",v.value={...t},p.value=!0},Y=t=>{Ee.confirm(`确定要删除课程 ${t.courseName} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Te(t.id),i.success("删除成功"),c()}catch(e){console.error("删除课程失败",e),i.error("删除课程失败")}}).catch(()=>{i.info("已取消删除")})},H=()=>{_.value.validate(async t=>{if(t)try{if(w.value){const{id:e,...n}=v.value;await Ve(e,n),i.success("课程信息更新成功")}else await Ne(v.value),i.success("课程添加成功");p.value=!1,await c()}catch(e){console.error("提交课程表单失败",e)}else return console.log("课程表单验证失败"),!1})},K=()=>{T()},J=t=>({COMPULSORY:"必修课",ELECTIVE:"选修课",GENERAL:"通识课"})[t]||t;return te(()=>{c(),O(),R()}),(t,e)=>{const n=me,Q=pe,W=ve,X=ce,Z=ye;return y(),F("div",xe,[a(l(_e),{class:"page-container"},{header:s(()=>[L("div",ze,[e[9]||(e[9]=L("span",null,"课程管理",-1)),a(l(f),{icon:l(be),type:"primary",onClick:q},{default:s(()=>e[8]||(e[8]=[g("添加课程")])),_:1},8,["icon"])])]),default:s(()=>[a(l(re),{inline:!0,model:u,class:"filter-form"},{default:s(()=>[a(l(C),{label:"课程名称/编号"},{default:s(()=>[a(l(ue),{modelValue:u.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>u.keyword=o),clearable:"",placeholder:"请输入课程名称或编号"},null,8,["modelValue"])]),_:1}),a(l(C),{label:"课程类型"},{default:s(()=>[a(l(N),{modelValue:u.courseType,"onUpdate:modelValue":e[1]||(e[1]=o=>u.courseType=o),clearable:"",placeholder:"请选择课程类型"},{default:s(()=>[a(l(d),{label:"全部",value:""}),a(l(d),{label:"必修课",value:"COMPULSORY"}),a(l(d),{label:"选修课",value:"ELECTIVE"}),a(l(d),{label:"通识课",value:"GENERAL"})]),_:1},8,["modelValue"])]),_:1}),a(l(C),{label:"所属学院"},{default:s(()=>[a(l(N),{modelValue:u.collegeId,"onUpdate:modelValue":e[2]||(e[2]=o=>u.collegeId=o),clearable:"",filterable:"",placeholder:"请选择学院"},{default:s(()=>[a(l(d),{label:"全部",value:""}),(y(!0),F(ne,null,de(S.value,o=>(y(),V(l(d),{key:o.id,label:o.collegeName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(l(C),{label:"状态"},{default:s(()=>[a(l(N),{modelValue:u.status,"onUpdate:modelValue":e[3]||(e[3]=o=>u.status=o),clearable:"",placeholder:"请选择课程状态"},{default:s(()=>[a(l(d),{label:"全部",value:""}),a(l(d),{label:"启用",value:"1"}),a(l(d),{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),a(l(C),null,{default:s(()=>[a(l(f),{icon:l(ie),type:"primary",onClick:A},{default:s(()=>e[10]||(e[10]=[g("查询")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),oe((y(),V(X,{data:I.value,style:{width:"100%"}},{empty:s(()=>[a(W,{description:"暂无课程数据"})]),default:s(()=>[a(n,{label:"课程名称",prop:"courseName","min-width":"180"}),a(n,{label:"课程编号",prop:"courseNo",width:"120"}),a(n,{label:"学分",prop:"credits",width:"80"}),a(n,{label:"课程类型",prop:"courseType",width:"100"},{default:s(o=>[g(k(J(o.row.courseType)),1)]),_:1}),a(n,{label:"所属学院","min-width":"150",prop:"collegeName"}),a(n,{label:"状态",prop:"status",width:"80"},{default:s(o=>[a(Q,{type:o.row.status===1?"success":"danger"},{default:s(()=>[g(k(o.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(n,{fixed:"right",label:"操作",width:"150"},{default:s(o=>[a(l(f),{icon:l(fe),circle:"",size:"small",type:"primary",onClick:ee=>G(o.row)},null,8,["icon","onClick"]),a(l(f),{icon:l(ge),circle:"",size:"small",type:"danger",onClick:ee=>Y(o.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[Z,E.value]]),h.value>0?(y(),V(l(Ce),{key:0,"current-page":m.value,"onUpdate:currentPage":e[4]||(e[4]=o=>m.value=o),"page-size":b.value,"onUpdate:pageSize":e[5]||(e[5]=o=>b.value=o),"page-sizes":[10,20,50],total:h.value,class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:j},null,8,["current-page","page-size","total"])):se("",!0)]),_:1}),a(l(we),{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=o=>p.value=o),"close-on-click-modal":!1,title:w.value?"编辑课程":"添加课程",width:"600px",onClose:K},{footer:s(()=>[L("span",Fe,[a(l(f),{onClick:e[6]||(e[6]=o=>p.value=!1)},{default:s(()=>e[11]||(e[11]=[g("取消")])),_:1}),a(l(f),{loading:D.value,type:"primary",onClick:H},{default:s(()=>[g(k(w.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:s(()=>[a(Ie,{ref_key:"courseFormRef",ref:_,"course-data":P.value,"is-edit":w.value,loading:M.value},null,8,["course-data","is-edit","loading"])]),_:1},8,["modelValue","title"])])}}}),qe=ae(Be,[["__scopeId","data-v-6d57fa4c"]]);export{qe as default};
