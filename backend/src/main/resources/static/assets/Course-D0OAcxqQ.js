import{_ as ue,r as n,o as ce,d as D,e as m,h as E,f as e,w as t,K as Q,L as Y,z as b,U as ie,T as de,l as pe,m as ve,V as me,k as _e,aM as fe,y as F,B as be,C as ge,D as ye,v as u,F as c,aN as we,x as Ce,H as Ee,a2 as he,aL as Te,A as Ve,aC as xe,aD as Ie,N as Le,P as f,af as K}from"./index-B2T-xuoP.js";/* empty css                   *//* empty css                             *//* empty css                    *//* empty css                    *//* empty css                        */import{g as Ne,a as Se}from"./course-C-HDut7x.js";import{r as j}from"./request-CvcqSNCl.js";const q={SELECT:"/course-selections/select",DROP:"/course-selections/drop"};function De(g){return j({url:q.SELECT,method:"post",data:g})}function ke(g){return j({url:q.DROP,method:"post",params:g})}const ze={class:"student-course-container"},Pe={class:"header"},Be={class:"filter-container"},Re={class:"pagination-container"},Ue={__name:"Course",setup(g){const k=n([{value:"2023-2024-1",label:"2023-2024学年第一学期"},{value:"2023-2024-2",label:"2023-2024学年第二学期"},{value:"2024-2025-1",label:"2024-2025学年第一学期"}]),J=n([{value:"REQUIRED",label:"必修课"},{value:"ELECTIVE",label:"选修课"},{value:"GENERAL",label:"通识课"},{value:"PHYSICAL",label:"体育课"}]),y=n(k.value[0].value),h=n(""),T=n(""),z=n("available"),P=n([]),B=n([]),V=n(!1),x=n(!1),w=n(1),C=n(10),R=n(0),U=n(!1),r=n(null),_=n(!1),p=async()=>{V.value=!0;try{const o={page:w.value,size:C.value,semester:y.value,courseType:h.value,keyword:T.value},l=await Ne(o);(l.code===0||l.code===200)&&(P.value=l.data.rows||l.data.list||[],R.value=l.data.total||0)}catch(o){console.error("获取可选课程失败",o),f.error("获取可选课程失败")}finally{V.value=!1}},I=async()=>{x.value=!0;try{const o=await Se({semester:y.value});(o.code===0||o.code===200)&&(B.value=o.data||[])}catch(o){console.error("获取已选课程失败",o),f.error("获取已选课程失败")}finally{x.value=!1}},W=async o=>{var l,v;_.value=!0;try{await K.confirm(`确认选择课程《${o.courseName}》吗？`,"选课确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),await De(o.id),f.success("选课成功"),p(),I()}catch(i){i!=="cancel"&&(console.error("选课失败",i),f.error(((v=(l=i.response)==null?void 0:l.data)==null?void 0:v.message)||"选课失败"))}finally{_.value=!1}},X=async o=>{var l,v;_.value=!0;try{await K.confirm(`确认退选课程《${o.courseName}》吗？`,"退课确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await ke(o.id),f.success("退课成功"),I(),p()}catch(i){i!=="cancel"&&(console.error("退课失败",i),f.error(((v=(l=i.response)==null?void 0:l.data)==null?void 0:v.message)||"退课失败"))}finally{_.value=!1}},Z=o=>{C.value=o,p()},ee=o=>{w.value=o,p()},L=o=>({REQUIRED:"danger",ELECTIVE:"success",GENERAL:"info",PHYSICAL:"warning"})[o]||"info",N=o=>({REQUIRED:"必修课",ELECTIVE:"选修课",GENERAL:"通识课",PHYSICAL:"体育课"})[o]||"未知",A=o=>{const l=o.selectedCount/o.capacity;return l>=1?"exception":l>=.8?"warning":"success"};return ce(()=>{p(),I()}),(o,l)=>{const v=ie,i=de,ae=pe,le=_e,s=ge,S=ye,$=we,O=Ce,H=be,te=he,M=fe,oe=Te,d=Ie,se=xe,re=Le,G=Ee;return m(),D("div",ze,[E("div",Pe,[l[7]||(l[7]=E("h2",null,"课程选择",-1)),E("div",Be,[e(i,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),clearable:"",placeholder:"学期",onChange:p},{default:t(()=>[(m(!0),D(Q,null,Y(k.value,a=>(m(),b(v,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(i,{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=a=>h.value=a),clearable:"",placeholder:"课程类型",onChange:p},{default:t(()=>[(m(!0),D(Q,null,Y(J.value,a=>(m(),b(v,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(le,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=a=>T.value=a),clearable:"",placeholder:"搜索课程名称或教师",onInput:p},{prefix:t(()=>[e(ae,null,{default:t(()=>[e(ve(me))]),_:1})]),_:1},8,["modelValue"])])]),e(oe,{modelValue:z.value,"onUpdate:modelValue":l[5]||(l[5]=a=>z.value=a)},{default:t(()=>[e(M,{label:"可选课程",name:"available"},{default:t(()=>[F((m(),b(H,{data:P.value,style:{width:"100%"}},{default:t(()=>[e(s,{label:"课程代码",prop:"courseCode",width:"120"}),e(s,{label:"课程名称",prop:"courseName",width:"180"}),e(s,{label:"授课教师",prop:"teacher",width:"120"}),e(s,{label:"课程类型",prop:"courseType",width:"120"},{default:t(a=>[e(S,{type:L(a.row.courseType)},{default:t(()=>[u(c(N(a.row.courseType)),1)]),_:2},1032,["type"])]),_:1}),e(s,{label:"学分",prop:"credit",width:"80"}),e(s,{label:"学期",prop:"semester",width:"120"}),e(s,{label:"上课时间","min-width":"180",prop:"schedule"}),e(s,{label:"上课地点",prop:"classroom",width:"120"}),e(s,{label:"容量",prop:"capacity",width:"120"},{default:t(a=>[u(c(a.row.selectedCount)+"/"+c(a.row.capacity)+" ",1),e($,{percentage:a.row.selectedCount/a.row.capacity*100,status:A(a.row)},null,8,["percentage","status"])]),_:1}),e(s,{fixed:"right",label:"操作",width:"120"},{default:t(a=>[e(O,{disabled:a.row.selectedCount>=a.row.capacity||a.row.isConflict,loading:_.value,size:"small",type:"primary",onClick:ne=>W(a.row)},{default:t(()=>l[8]||(l[8]=[u(" 选课 ")])),_:2},1032,["disabled","loading","onClick"])]),_:1})]),_:1},8,["data"])),[[G,V.value]]),E("div",Re,[e(te,{"current-page":w.value,"onUpdate:currentPage":l[3]||(l[3]=a=>w.value=a),"page-size":C.value,"onUpdate:pageSize":l[4]||(l[4]=a=>C.value=a),"page-sizes":[10,20,30,50],total:R.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),e(M,{label:"已选课程",name:"selected"},{default:t(()=>[F((m(),b(H,{data:B.value,style:{width:"100%"}},{default:t(()=>[e(s,{label:"课程代码",prop:"courseCode",width:"120"}),e(s,{label:"课程名称",prop:"courseName",width:"180"}),e(s,{label:"授课教师",prop:"teacher",width:"120"}),e(s,{label:"课程类型",prop:"courseType",width:"120"},{default:t(a=>[e(S,{type:L(a.row.courseType)},{default:t(()=>[u(c(N(a.row.courseType)),1)]),_:2},1032,["type"])]),_:1}),e(s,{label:"学分",prop:"credit",width:"80"}),e(s,{label:"学期",prop:"semester",width:"120"}),e(s,{label:"上课时间","min-width":"180",prop:"schedule"}),e(s,{label:"上课地点",prop:"classroom",width:"120"}),e(s,{label:"选课时间",prop:"selectTime",width:"180"}),e(s,{fixed:"right",label:"操作",width:"120"},{default:t(a=>[e(O,{loading:_.value,size:"small",type:"danger",onClick:ne=>X(a.row)},{default:t(()=>l[9]||(l[9]=[u(" 退课 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[G,x.value]])]),_:1})]),_:1},8,["modelValue"]),e(re,{modelValue:U.value,"onUpdate:modelValue":l[6]||(l[6]=a=>U.value=a),title:"课程详情",width:"60%"},{default:t(()=>[r.value?(m(),b(se,{key:0,column:2,border:""},{default:t(()=>[e(d,{label:"课程代码"},{default:t(()=>[u(c(r.value.courseCode),1)]),_:1}),e(d,{label:"课程名称"},{default:t(()=>[u(c(r.value.courseName),1)]),_:1}),e(d,{label:"课程类型"},{default:t(()=>[e(S,{type:L(r.value.courseType)},{default:t(()=>[u(c(N(r.value.courseType)),1)]),_:1},8,["type"])]),_:1}),e(d,{label:"学分"},{default:t(()=>[u(c(r.value.credit),1)]),_:1}),e(d,{label:"授课教师"},{default:t(()=>[u(c(r.value.teacher),1)]),_:1}),e(d,{label:"学期"},{default:t(()=>[u(c(r.value.semester),1)]),_:1}),e(d,{span:2,label:"上课时间"},{default:t(()=>[u(c(r.value.schedule),1)]),_:1}),e(d,{label:"上课地点"},{default:t(()=>[u(c(r.value.classroom),1)]),_:1}),e(d,{label:"课程容量"},{default:t(()=>[u(c(r.value.selectedCount)+"/"+c(r.value.capacity)+" ",1),e($,{percentage:r.value.selectedCount/r.value.capacity*100,status:A(r.value)},null,8,["percentage","status"])]),_:1}),e(d,{span:2,label:"课程简介"},{default:t(()=>[u(c(r.value.description||"暂无课程简介"),1)]),_:1})]),_:1})):Ve("",!0)]),_:1},8,["modelValue"])])}}},Fe=ue(Ue,[["__scopeId","data-v-11a2c630"]]);export{Fe as default};
