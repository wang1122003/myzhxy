import{_ as P,r as s,a as R,o as $,d as O,e as p,f as o,w as r,y as G,z as g,A as H,m as t,i as A,j as h,k as F,T as J,U as d,x as k,V as K,v as u,B as q,C as c,l as Q,aH as W,aI as X,aJ as Y,M as Z,F as b,G as ee,H as ae,a2 as le,h as T,g as te,P as _,af as oe}from"./index-D-KotFfR.js";import{c as re,l as ne,d as ie,a as se}from"./file-BRx9_MxA.js";import"./request-D0VF7A5d.js";const de={class:"file-management-container"},ue={__name:"File",setup(pe){const x=s(!1),w=s([]),f=s(0),m=s(1),y=s(10),i=R({filename:"",uploaderName:"",fileType:""}),C=s(null),z=s(null),V=e=>(console.warn("getFilePreviewUrl needs implementation",e),"#"),E=e=>{var n;if(!e)return!1;const a=((n=e.split(".").pop())==null?void 0:n.toLowerCase())||"";return["doc","docx","pdf","txt","xls","xlsx","ppt","pptx"].includes(a)},B=e=>{var n;if(!e)return!1;const a=((n=e.split(".").pop())==null?void 0:n.toLowerCase())||"";return["jpg","jpeg","png","gif","bmp","webp"].includes(a)},L=e=>{if(e===0)return"0 Bytes";if(!e)return"-";const a=1024,n=["Bytes","KB","MB","GB","TB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+n[l]},U=e=>{var n;if(!e)return"未知";if(E(e))return"文档";if(B(e))return"图片";const a=((n=e.split(".").pop())==null?void 0:n.toLowerCase())||"";return["mp4","avi","mov","wmv"].includes(a)?"视频":["mp3","wav","ogg"].includes(a)?"音频":["zip","rar","7z","tar","gz"].includes(a)?"压缩包":"其他"},N=e=>{if(!e)return"-";try{return new Date(e).toLocaleString()}catch{return e}},v=async()=>{x.value=!0;try{const e={page:m.value,size:y.value,filename:i.filename||void 0,uploaderName:i.uploaderName||void 0,fileType:i.fileType||void 0},a=await ne(e);a.code===200&&a.data?(w.value=a.data.list||[],f.value=a.data.total||0):(_.error(a.message||"获取文件列表失败"),w.value=[],f.value=0)}catch(e){console.error("加载文件列表失败:",e),w.value=[],f.value=0}finally{x.value=!1}},D=async e=>{if(!(!e||!e.id)){C.value=e.id;try{const a=await ie(e.id),n=new Blob([a],{type:"application/octet-stream"}),l=document.createElement("a");l.href=URL.createObjectURL(n),l.download=e.filename||`file_${e.id}`,document.body.appendChild(l),l.click(),URL.revokeObjectURL(l.href),document.body.removeChild(l)}catch(a){console.error("下载文件失败:",a),_.error("下载文件失败")}finally{C.value=null}}},M=e=>{!e||!e.id||oe.confirm(`确定要删除文件 "${e.filename}" 吗? 此操作不可恢复。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{z.value=e.id;try{await se(e.id),_.success("文件删除成功"),v()}catch(a){console.error("删除文件失败:",a)}finally{z.value=null}}).catch(()=>{_.info("已取消删除")})},S=e=>{y.value=e,m.value=1,v()},I=e=>{m.value=e,v()};return $(()=>{v(),re().catch(e=>console.warn("Failed to load file stats",e))}),(e,a)=>{const n=ae;return p(),O("div",de,[o(t(te),{class:"page-container"},{header:r(()=>a[5]||(a[5]=[T("div",{class:"header"},[T("span",null,"文件管理")],-1)])),default:r(()=>[o(t(A),{inline:!0,model:i,class:"filter-form"},{default:r(()=>[o(t(h),{label:"文件名"},{default:r(()=>[o(t(F),{modelValue:i.filename,"onUpdate:modelValue":a[0]||(a[0]=l=>i.filename=l),clearable:"",placeholder:"输入文件名关键词"},null,8,["modelValue"])]),_:1}),o(t(h),{label:"上传者"},{default:r(()=>[o(t(F),{modelValue:i.uploaderName,"onUpdate:modelValue":a[1]||(a[1]=l=>i.uploaderName=l),clearable:"",placeholder:"输入上传者姓名/ID"},null,8,["modelValue"])]),_:1}),o(t(h),{label:"文件类型"},{default:r(()=>[o(t(J),{modelValue:i.fileType,"onUpdate:modelValue":a[2]||(a[2]=l=>i.fileType=l),clearable:"",placeholder:"选择文件类型"},{default:r(()=>[o(t(d),{label:"全部",value:""}),o(t(d),{label:"文档",value:"document"}),o(t(d),{label:"图片",value:"image"}),o(t(d),{label:"视频",value:"video"}),o(t(d),{label:"音频",value:"audio"}),o(t(d),{label:"压缩包",value:"archive"}),o(t(d),{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),o(t(h),null,{default:r(()=>[o(t(k),{icon:t(K),type:"primary",onClick:v},{default:r(()=>a[6]||(a[6]=[u("查询")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),G((p(),g(t(q),{data:w.value,style:{width:"100%"},border:"",size:"small",stripe:""},{empty:r(()=>[o(t(ee),{description:"暂无文件数据"})]),default:r(()=>[o(t(c),{label:"文件名","min-width":"250",prop:"filename","show-overflow-tooltip":""},{default:r(l=>[o(t(Q),{style:{"vertical-align":"middle","margin-right":"5px"}},{default:r(()=>[E(l.row.filename)?(p(),g(t(W),{key:0})):B(l.row.filename)?(p(),g(t(X),{key:1})):(p(),g(t(Y),{key:2}))]),_:2},1024),o(t(Z),{href:V(l.row),underline:!1,target:"_blank",type:"primary"},{default:r(()=>[u(b(l.row.filename),1)]),_:2},1032,["href"])]),_:1}),o(t(c),{label:"大小",prop:"fileSize",width:"120"},{default:r(l=>[u(b(L(l.row.fileSize)),1)]),_:1}),o(t(c),{label:"类型",prop:"fileType",width:"100"},{default:r(l=>[u(b(U(l.row.filename)),1)]),_:1}),o(t(c),{label:"上传者",prop:"uploaderName",width:"120"}),o(t(c),{label:"上传时间",prop:"uploadTime",width:"180"},{default:r(l=>[u(b(N(l.row.uploadTime)),1)]),_:1}),o(t(c),{fixed:"right",label:"操作",width:"150"},{default:r(l=>[o(t(k),{loading:C.value===l.row.id,size:"small",type:"primary",onClick:j=>D(l.row)},{default:r(()=>a[7]||(a[7]=[u(" 下载 ")])),_:2},1032,["loading","onClick"]),o(t(k),{loading:z.value===l.row.id,size:"small",type:"danger",onClick:j=>M(l.row)},{default:r(()=>a[8]||(a[8]=[u(" 删除 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[n,x.value]]),f.value>0?(p(),g(t(le),{key:0,"current-page":m.value,"onUpdate:currentPage":a[3]||(a[3]=l=>m.value=l),"page-size":y.value,"onUpdate:pageSize":a[4]||(a[4]=l=>y.value=l),"page-sizes":[10,20,50,100],total:f.value,class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:I},null,8,["current-page","page-size","total"])):H("",!0)]),_:1})])}}},ve=P(ue,[["__scopeId","data-v-cdf4ed68"]]);export{ve as default};
