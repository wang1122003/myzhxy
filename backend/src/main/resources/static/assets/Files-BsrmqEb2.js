import{_ as ie,u as ue,r as n,o as de,d as T,e as r,h as d,f as o,w as s,m as l,x as E,v as c,l as j,aB as ce,aA as pe,aM as A,y as O,A as S,z as i,B as W,C as u,an as G,aP as H,al as K,F as f,H as fe,a2 as q,G as J,T as ge,K as ve,L as me,U as he,aL as we,P as v,af as ye}from"./index-B2T-xuoP.js";import{g as _e,a as Ce}from"./file-6fcn3QKr.js";import{a as xe}from"./course-C-HDut7x.js";import{f as Q,a as X}from"./formatters-COdykrJD.js";import"./request-CvcqSNCl.js";const be={class:"files-container"},ze={class:"page-header"},ke={class:"actions"},Te={class:"file-list-container"},Ee={class:"file-name"},Se={key:0,class:"pagination-container"},Fe={class:"course-resource-container"},Le={class:"filter-container"},Ue={class:"file-name"},Be={key:0,class:"pagination-container"},Pe={name:"FileManagement"},Ve=Object.assign(Pe,{setup(Me){ue();const y=n(!1),_=n([]),F=n(0),m=n(1),C=n(10),x=n(null),L=n(null),U=n("personal"),b=n([]),z=n(!1),B=n(0),g=n(1),k=n(10),P=n([]),V=n(null),M=n(!1),Y=n(!1),h=async()=>{y.value=!0;try{const e=await _e({page:m.value,size:C.value});_.value=e.data.records,F.value=e.data.total}catch(e){console.error("Error loading files:",e),v.error("加载文件列表失败")}finally{y.value=!1}},w=async()=>{z.value=!0;try{const e=await getResourceList({page:g.value,size:k.value,courseId:V.value});b.value=e.data.list||[],B.value=e.data.total||0}catch(e){console.error("获取课程资源失败",e),v.error("获取课程资源失败")}finally{z.value=!1}},D=async()=>{M.value=!0;try{const e=await xe();P.value=e.data||[]}catch(e){console.error("获取课程列表失败",e)}finally{M.value=!1}},Z=e=>{e.status==="ready"&&handleUpload(e.raw)},N=async e=>{x.value=e.id;try{await downloadFile(e.id),v.success("文件下载成功")}catch(t){console.error("文件下载失败",t),v.error("文件下载失败")}finally{x.value=null}},ee=e=>{ye.confirm("确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{L.value=e.id;try{await Ce(e.id),v.success("文件删除成功"),h()}catch(t){console.error("文件删除失败",t),v.error("文件删除失败")}finally{L.value=null}}).catch(()=>{})},ae=e=>{C.value=e,m.value=1,h()},le=e=>{m.value=e,h()},te=e=>{k.value=e,g.value=1,w()},oe=e=>{g.value=e,w()},se=()=>{g.value=1,w()},ne=e=>{e.props.name==="course"?(P.value.length===0&&D(),b.value.length===0&&w()):e.props.name==="personal"&&_.value.length===0&&h()},R=e=>[".doc",".docx",".pdf",".xls",".xlsx",".ppt",".pptx",".txt"].some(p=>e.toLowerCase().endsWith(p)),I=e=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(p=>e.toLowerCase().endsWith(p)),re=e=>{if(!e)return"未知";const t=e.split(".").pop().toLowerCase();return{doc:"文档",docx:"文档",pdf:"PDF",xls:"表格",xlsx:"表格",ppt:"演示文稿",pptx:"演示文稿",txt:"文本",jpg:"图片",jpeg:"图片",png:"图片",gif:"图片",bmp:"图片",webp:"图片",mp4:"视频",avi:"视频",mov:"视频",mp3:"音频",wav:"音频",zip:"压缩包",rar:"压缩包","7z":"压缩包"}[t]||t.toUpperCase()};return de(()=>{h(),U.value==="course"&&(D(),w())}),(e,t)=>{const p=fe;return r(),T("div",be,[d("div",ze,[t[7]||(t[7]=d("h2",null,"文件管理",-1)),d("div",ke,[o(l(pe),{"auto-upload":!1,"on-change":Z,"show-file-list":!1,class:"upload-button"},{default:s(()=>[o(l(E),{loading:Y.value,type:"primary"},{default:s(()=>[o(l(j),null,{default:s(()=>[o(l(ce))]),_:1}),t[6]||(t[6]=c(" 上传文件 "))]),_:1},8,["loading"])]),_:1})])]),o(l(we),{modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=a=>U.value=a),onTabClick:ne},{default:s(()=>[o(l(A),{label:"我的文件",name:"personal"},{default:s(()=>[d("div",Te,[O((r(),i(l(W),{data:_.value,style:{width:"100%"}},{default:s(()=>[o(l(u),{label:"文件名","min-width":"200"},{default:s(a=>[d("div",Ee,[o(l(j),{class:"file-icon"},{default:s(()=>[R(a.row.filename)?(r(),i(l(G),{key:0})):I(a.row.filename)?(r(),i(l(H),{key:1})):(r(),i(l(K),{key:2}))]),_:2},1024),d("span",null,f(a.row.filename),1)])]),_:1}),o(l(u),{label:"大小",prop:"fileSize",width:"120"},{default:s(a=>[c(f(l(Q)(a.row.fileSize)),1)]),_:1}),o(l(u),{label:"类型",prop:"fileType",width:"120"},{default:s(a=>[c(f(re(a.row.filename)),1)]),_:1}),o(l(u),{label:"上传时间",prop:"uploadTime",width:"180"},{default:s(a=>[c(f(l(X)(a.row.uploadTime)),1)]),_:1}),o(l(u),{fixed:"right",label:"操作",width:"200"},{default:s(a=>[o(l(E),{loading:x.value===a.row.id,size:"small",type:"primary",onClick:$=>N(a.row)},{default:s(()=>t[8]||(t[8]=[c(" 下载 ")])),_:2},1032,["loading","onClick"]),o(l(E),{loading:L.value===a.row.id,size:"small",type:"danger",onClick:$=>ee(a.row)},{default:s(()=>t[9]||(t[9]=[c(" 删除 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[p,y.value]]),F.value>0?(r(),T("div",Se,[o(l(q),{"current-page":m.value,"onUpdate:currentPage":t[0]||(t[0]=a=>m.value=a),"page-size":C.value,"onUpdate:pageSize":t[1]||(t[1]=a=>C.value=a),"page-sizes":[10,20,50,100],total:F.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:le},null,8,["current-page","page-size","total"])])):S("",!0),_.value.length===0&&!y.value?(r(),i(l(J),{key:1,description:"暂无文件"})):S("",!0)])]),_:1}),o(l(A),{label:"课程资料",name:"course"},{default:s(()=>[d("div",Fe,[d("div",Le,[o(l(ge),{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=a=>V.value=a),clearable:"",placeholder:"选择课程",style:{width:"220px"},loading:M.value,filterable:"",onChange:se},{default:s(()=>[(r(!0),T(ve,null,me(P.value,a=>(r(),i(l(he),{key:a.id,label:a.courseName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),O((r(),i(l(W),{data:b.value,style:{width:"100%"}},{default:s(()=>[o(l(u),{label:"文件名","min-width":"200"},{default:s(a=>[d("div",Ue,[o(l(j),{class:"file-icon"},{default:s(()=>[R(a.row.filename)?(r(),i(l(G),{key:0})):I(a.row.filename)?(r(),i(l(H),{key:1})):(r(),i(l(K),{key:2}))]),_:2},1024),d("span",null,f(a.row.filename),1)])]),_:1}),o(l(u),{label:"所属课程",prop:"courseName",width:"180"}),o(l(u),{label:"上传人",prop:"uploadUser",width:"120"}),o(l(u),{label:"大小",prop:"fileSize",width:"120"},{default:s(a=>[c(f(l(Q)(a.row.fileSize)),1)]),_:1}),o(l(u),{label:"上传时间",prop:"uploadTime",width:"180"},{default:s(a=>[c(f(l(X)(a.row.uploadTime)),1)]),_:1}),o(l(u),{fixed:"right",label:"操作",width:"120"},{default:s(a=>[o(l(E),{loading:x.value===a.row.id,size:"small",type:"primary",onClick:$=>N(a.row)},{default:s(()=>t[10]||(t[10]=[c(" 下载 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[p,z.value]]),B.value>0?(r(),T("div",Be,[o(l(q),{"current-page":g.value,"onUpdate:currentPage":t[3]||(t[3]=a=>g.value=a),"page-size":k.value,"onUpdate:pageSize":t[4]||(t[4]=a=>k.value=a),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:oe},null,8,["current-page","page-size","total"])])):S("",!0),b.value.length===0&&!z.value?(r(),i(l(J),{key:1,description:"暂无课程资料"})):S("",!0)])]),_:1})]),_:1},8,["modelValue"])])}}}),$e=ie(Ve,[["__scopeId","data-v-88acc921"]]);export{$e as default};
