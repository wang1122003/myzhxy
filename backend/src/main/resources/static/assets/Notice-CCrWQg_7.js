import{_ as re,r as u,a as ue,o as ie,d as de,e as E,f as t,w as o,y as ce,z as I,A as h,i as pe,j as me,k as fe,T as ve,U as ge,x as _e,m as A,V as ye,v as r,B as be,C as Ee,F as w,D as we,G as Ce,H as Ve,a2 as Te,h as k,aN as De,g as Se,aw as Ne,ax as Ie,N as Ae,P as d,af as z}from"./index-D-KotFfR.js";/* empty css                   *//* empty css                       *//* empty css                 *//* empty css                        */import{b as ke,a as Be,u as Re,d as Ue,c as Le,e as xe}from"./notice-D5CZK27a.js";import{b as he}from"./formatters-COdykrJD.js";import{R as ze,N as Me}from"./NoticeDetailDialog-CRdpNsFs.js";import"./request-D0VF7A5d.js";const Fe={class:"notice-management-container"},Pe={class:"header"},He={class:"dialog-footer"},Ye=Object.assign({name:"AdminNoticeManagement"},{__name:"Notice",setup(Oe){const C=u(!1),B=u([]),V=u(0),y=u(1),b=u(10),i=ue({title:"",status:"",type:""}),v=u(!1),T=u(!1),g=u(!1),D=u(!1),n=u({id:null,title:"",content:"",type:"SYSTEM",status:"PUBLISHED"}),R=u(null),_=u(null),M={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},m=async()=>{C.value=!0;try{const l={page:y.value,size:b.value,title:i.title||null,status:i.status||null,type:i.type||null},e=await ke(l);B.value=e.data.records||[],V.value=e.data.total||0}catch(l){console.error("获取公告列表失败:",l),d.error("获取公告列表失败")}finally{C.value=!1}},F=l=>{n.value&&(n.value.content=l)},P=()=>{var l;g.value=!1,n.value={id:null,title:"",content:"",type:"SYSTEM",status:"PUBLISHED"},v.value=!0,(l=_.value)==null||l.resetFields()},H=async l=>{g.value=!0,X();try{const e=await Be(l.id);e.code===200&&e.data?(n.value={...e.data},v.value=!0):d.error(e.message||"获取公告详情失败")}catch(e){console.error("获取公告详情失败",e),d.error("获取公告详情失败")}},Y=l=>{R.value=l.id,T.value=!0},O=async l=>{await z.confirm("确定要撤回该公告吗？撤回后将变为草稿状态。 ","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await Re(l.id,"DRAFT"),d.success("公告撤回成功"),m()}catch(e){console.error("撤回公告失败:",e),d.error("撤回公告失败")}},$=async l=>{await z.confirm("确定要删除该公告吗？此操作不可恢复。 ","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await Ue(l.id),d.success("公告删除成功"),m()}catch(e){console.error("删除公告失败:",e),d.error("删除公告失败")}},q=()=>{var l;(l=_.value)==null||l.clearValidate()},j=async()=>{_.value&&await _.value.validate(async l=>{if(l){D.value=!0;try{g.value?(await Le(n.value.id,n.value),d.success("公告更新成功")):(await xe(n.value),d.success("公告发布成功")),v.value=!1,m()}catch(e){console.error("提交公告失败:",e),d.error(g.value?"更新公告失败":"发布公告失败")}finally{D.value=!1}}})},G=l=>{b.value=l,y.value=1,m()},J=l=>{y.value=l,m()},K=l=>{switch(l){case"PUBLISHED":case 1:return"success";case"DRAFT":case 0:return"warning";case"RECALLED":return"info";default:return"info"}},Q=l=>{switch(l){case"PUBLISHED":case 1:return"已发布";case"DRAFT":case 0:return"草稿";case"RECALLED":return"已撤回";default:return l||"未知"}},W=l=>{switch(l){case"SYSTEM":return"系统通知";case"ACADEMIC":return"教学通知";case"ACTIVITY":return"活动通知";case"OTHER":return"其他通知";default:return l||"未知"}},X=()=>{var l;n.value={id:null,title:"",content:"",type:"SYSTEM",status:"PUBLISHED"},(l=_.value)==null||l.resetFields()};return ie(()=>{m()}),(l,e)=>{const c=_e,U=fe,p=me,s=ge,S=ve,L=pe,f=Ee,Z=we,ee=Ce,te=be,le=Te,ae=Se,x=Ie,oe=Ne,ne=Ae,se=Ve;return E(),de("div",Fe,[t(ae,{class:"page-container"},{header:o(()=>[k("div",Pe,[e[13]||(e[13]=k("span",null,"公告管理",-1)),t(c,{icon:A(De),type:"primary",onClick:P},{default:o(()=>e[12]||(e[12]=[r("发布公告")])),_:1},8,["icon"])])]),default:o(()=>[t(L,{inline:!0,model:i,class:"filter-form"},{default:o(()=>[t(p,{label:"标题"},{default:o(()=>[t(U,{modelValue:i.title,"onUpdate:modelValue":e[0]||(e[0]=a=>i.title=a),clearable:"",placeholder:"请输入公告标题关键词"},null,8,["modelValue"])]),_:1}),t(p,{label:"状态"},{default:o(()=>[t(S,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=a=>i.status=a),clearable:"",placeholder:"请选择状态"},{default:o(()=>[t(s,{label:"全部",value:""}),t(s,{label:"已发布",value:"PUBLISHED"}),t(s,{label:"草稿",value:"DRAFT"}),t(s,{label:"已撤回",value:"RECALLED"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"类型"},{default:o(()=>[t(S,{modelValue:i.type,"onUpdate:modelValue":e[2]||(e[2]=a=>i.type=a),clearable:"",placeholder:"请选择类型"},{default:o(()=>[t(s,{label:"全部",value:""}),t(s,{label:"系统通知",value:"SYSTEM"}),t(s,{label:"教学通知",value:"ACADEMIC"}),t(s,{label:"活动通知",value:"ACTIVITY"}),t(s,{label:"其他通知",value:"OTHER"})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:o(()=>[t(c,{icon:A(ye),type:"primary",onClick:m},{default:o(()=>e[14]||(e[14]=[r("查询")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),ce((E(),I(te,{data:B.value,style:{width:"100%"}},{empty:o(()=>[t(ee,{description:"暂无公告数据"})]),default:o(()=>[t(f,{label:"标题","min-width":"200",prop:"title","show-overflow-tooltip":""}),t(f,{label:"类型",prop:"type",width:"120"},{default:o(a=>[r(w(W(a.row.type)),1)]),_:1}),t(f,{label:"状态",prop:"status",width:"100"},{default:o(a=>[t(Z,{type:K(a.row.status)},{default:o(()=>[r(w(Q(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(f,{label:"发布者",prop:"publisherName",width:"120"}),t(f,{label:"发布时间",prop:"publishTime",width:"160"},{default:o(a=>[r(w(A(he)(a.row.publishTime)),1)]),_:1}),t(f,{label:"阅读量",prop:"readCount",width:"80"}),t(f,{fixed:"right",label:"操作",width:"220"},{default:o(a=>[t(c,{size:"small",type:"primary",onClick:N=>Y(a.row)},{default:o(()=>e[15]||(e[15]=[r("查看")])),_:2},1032,["onClick"]),t(c,{disabled:a.row.status==="RECALLED",size:"small",onClick:N=>H(a.row)},{default:o(()=>e[16]||(e[16]=[r(" 编辑 ")])),_:2},1032,["disabled","onClick"]),a.row.status==="PUBLISHED"?(E(),I(c,{key:0,size:"small",type:"warning",onClick:N=>O(a.row)},{default:o(()=>e[17]||(e[17]=[r(" 撤回 ")])),_:2},1032,["onClick"])):h("",!0),t(c,{size:"small",type:"danger",onClick:N=>$(a.row)},{default:o(()=>e[18]||(e[18]=[r("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,C.value]]),V.value>0?(E(),I(le,{key:0,"current-page":y.value,"onUpdate:currentPage":e[3]||(e[3]=a=>y.value=a),"page-size":b.value,"onUpdate:pageSize":e[4]||(e[4]=a=>b.value=a),"page-sizes":[10,20,50],total:V.value,class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:J},null,8,["current-page","page-size","total"])):h("",!0)]),_:1}),t(ne,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=a=>v.value=a),title:g.value?"编辑公告":"发布公告","close-on-click-modal":!1,width:"70%",top:"5vh",onClose:q},{footer:o(()=>[k("span",He,[t(c,{onClick:e[9]||(e[9]=a=>v.value=!1)},{default:o(()=>e[21]||(e[21]=[r("取消")])),_:1}),t(c,{loading:D.value,type:"primary",onClick:j},{default:o(()=>[r(w(g.value?"保存":"发布"),1)]),_:1},8,["loading"])])]),default:o(()=>[t(L,{ref_key:"noticeFormRef",ref:_,model:n.value,rules:M,"label-width":"100px"},{default:o(()=>[t(p,{label:"公告标题",prop:"title"},{default:o(()=>[t(U,{modelValue:n.value.title,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.title=a),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(p,{label:"公告类型",prop:"type"},{default:o(()=>[t(S,{modelValue:n.value.type,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.type=a),placeholder:"请选择公告类型",style:{width:"100%"}},{default:o(()=>[t(s,{label:"系统通知",value:"SYSTEM"}),t(s,{label:"教学通知",value:"ACADEMIC"}),t(s,{label:"活动通知",value:"ACTIVITY"}),t(s,{label:"其他通知",value:"OTHER"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"公告内容",prop:"content"},{default:o(()=>[t(ze,{modelValue:n.value.content,"onUpdate:modelValue":[e[7]||(e[7]=a=>n.value.content=a),F]},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:o(()=>[t(oe,{modelValue:n.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.status=a)},{default:o(()=>[t(x,{label:"PUBLISHED"},{default:o(()=>e[19]||(e[19]=[r("直接发布")])),_:1}),t(x,{label:"DRAFT"},{default:o(()=>e[20]||(e[20]=[r("存为草稿")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(Me,{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=a=>T.value=a),"notice-id":R.value},null,8,["modelValue","notice-id"])])}}}),Ze=re(Ye,[["__scopeId","data-v-ec907ee3"]]);export{Ze as default};
