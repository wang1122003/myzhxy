import{_ as ee,r as c,a as A,o as te,d,e as i,h as s,f as l,w as n,K as V,L as I,U as ae,T as le,l as ne,m as L,V as oe,k as se,y as ie,A as g,z as S,B as re,C as ce,D as de,v as m,F as u,x as ue,aQ as pe,H as me,a2 as _e,g as ve,J as fe,an as ge,N as ye,P as y}from"./index-B2T-xuoP.js";/* empty css                   *//* empty css                   *//* empty css                        */import{b as we,a as he}from"./notice-Bm9D3gjc.js";import{d as be}from"./file-6fcn3QKr.js";import"./request-CvcqSNCl.js";const Ce={class:"notices-container"},Ee={class:"page-header"},Ne={class:"filter-container"},ke={class:"notice-title"},Te={key:0,class:"pagination-container"},Ve={class:"notice-meta"},Se=["innerHTML"],Ue={key:0,class:"notice-attachments"},De={class:"dialog-footer"},Me={__name:"Notices",setup(ze){const B=[{label:"全部",value:""},{label:"公告",value:"ANNOUNCEMENT"},{label:"课程",value:"COURSE"},{label:"考试",value:"EXAM"},{label:"活动",value:"ACTIVITY"},{label:"其他",value:"OTHER"}],U=c([]),C=c(!1),E=c(0),_=c(1),w=c(10),p=A({type:"",keyword:""}),v=c(!1),o=A({}),N=c(null),h=async()=>{C.value=!0;try{const t={page:_.value,size:w.value,type:p.type||null,keyword:p.keyword||null},e=await we(t);U.value=e.data.list||[],E.value=e.data.total||0}catch(t){console.error("获取公告列表失败",t),y.error("获取公告列表失败")}finally{C.value=!1}},$=async t=>{try{const e=await he(t);e.code===200&&e.data?(o.value=e.data,o.value.htmlContent=o.value.content,v.value=!0):y.error(e.message||"获取通知详情失败")}catch(e){console.error("获取通知详情失败:",e),y.error("获取通知详情失败")}},H=t=>({ANNOUNCEMENT:"",COURSE:"success",EXAM:"danger",ACTIVITY:"warning",OTHER:"info"})[t]||"info",D=t=>({ANNOUNCEMENT:"公告",COURSE:"课程",EXAM:"考试",ACTIVITY:"活动",OTHER:"其他"})[t]||"通知",F=t=>{if(!t)return!1;const e=new Date,f=new Date(t),r=Math.abs(e-f);return Math.ceil(r/(1e3*60*60*24))<=3},M=t=>{if(!t)return"-";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},z=()=>{_.value=1,h()},P=t=>{w.value=t,h()},j=t=>{_.value=t,h()},Y=t=>{O(t)},O=async t=>{v.value=!0,Object.assign(o,t),await $(t.id)},X=async t=>{N.value=t.id;try{const e=await be(t.id),f=new Blob([e.data]),r=document.createElement("a");r.href=URL.createObjectURL(f),r.download=t.filename,r.click(),URL.revokeObjectURL(r.href),y.success("文件下载成功")}catch(e){console.error("文件下载失败",e),y.error("文件下载失败")}finally{N.value=null}};return te(()=>{h()}),(t,e)=>{const f=ae,r=le,k=ne,J=se,x=de,b=ce,T=ue,K=re,Q=_e,q=ve,G=fe,W=ye,Z=me;return i(),d("div",Ce,[s("div",Ee,[e[6]||(e[6]=s("h2",null,"校园公告",-1)),s("div",Ne,[l(r,{modelValue:p.type,"onUpdate:modelValue":e[0]||(e[0]=a=>p.type=a),clearable:"",placeholder:"公告类型",style:{width:"120px","margin-right":"15px"},onChange:z},{default:n(()=>[(i(),d(V,null,I(B,a=>l(f,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(J,{modelValue:p.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>p.keyword=a),clearable:"",placeholder:"搜索公告标题",style:{width:"220px"},onInput:z},{prefix:n(()=>[l(k,null,{default:n(()=>[l(L(oe))]),_:1})]),_:1},8,["modelValue"])])]),l(q,{class:"notice-list-card",shadow:"hover"},{default:n(()=>[ie((i(),S(K,{data:U.value,style:{width:"100%"},onRowClick:Y},{default:n(()=>[l(b,{label:"标题","min-width":"300",prop:"title"},{default:n(a=>[s("div",ke,[a.row.type?(i(),S(x,{key:0,type:H(a.row.type),class:"notice-tag",size:"small"},{default:n(()=>[m(u(D(a.row.type)),1)]),_:2},1032,["type"])):g("",!0),s("span",null,u(a.row.title),1),F(a.row.publishTime)?(i(),S(x,{key:1,class:"new-tag",effect:"plain",size:"small",type:"danger"},{default:n(()=>e[7]||(e[7]=[m(" 新 ")])),_:1})):g("",!0)])]),_:1}),l(b,{label:"发布者",prop:"publisher",width:"150"}),l(b,{label:"发布时间",prop:"publishTime",width:"180"},{default:n(a=>[m(u(M(a.row.publishTime)),1)]),_:1}),l(b,{fixed:"right",label:"操作",width:"120"},{default:n(a=>[l(T,{size:"small",type:"primary",onClick:pe(R=>O(a.row),["stop"])},{default:n(()=>e[8]||(e[8]=[m(" 查看详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,C.value]]),E.value>0?(i(),d("div",Te,[l(Q,{"current-page":_.value,"onUpdate:currentPage":e[2]||(e[2]=a=>_.value=a),"page-size":w.value,"onUpdate:pageSize":e[3]||(e[3]=a=>w.value=a),layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50],total:E.value,onSizeChange:P,onCurrentChange:j},null,8,["current-page","page-size","total"])])):g("",!0)]),_:1}),l(W,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),title:o.title,"destroy-on-close":"",top:"5vh",width:"60%"},{footer:n(()=>[s("span",De,[l(T,{onClick:e[4]||(e[4]=a=>v.value=!1)},{default:n(()=>e[10]||(e[10]=[m("关闭")])),_:1})])]),default:n(()=>[o.id?(i(),d(V,{key:0},[s("div",Ve,[s("span",null,"发布人: "+u(o.publisher),1),s("span",null,"发布时间: "+u(M(o.publishTime)),1),s("span",null,"类型: "+u(D(o.type)),1)]),l(G),s("div",{class:"notice-content",innerHTML:o.content},null,8,Se),o.attachments&&o.attachments.length>0?(i(),d("div",Ue,[e[9]||(e[9]=s("h4",null,"附件列表:",-1)),(i(!0),d(V,null,I(o.attachments,(a,R)=>(i(),d("div",{key:R,class:"attachment-item"},[l(T,{loading:N.value===a.id,link:"",type:"primary",onClick:Oe=>X(a)},{default:n(()=>[l(k,null,{default:n(()=>[l(L(ge))]),_:1}),m(" "+u(a.filename),1)]),_:2},1032,["loading","onClick"])]))),128))])):g("",!0)],64)):g("",!0)]),_:1},8,["modelValue","title"])])}}},He=ee(Me,[["__scopeId","data-v-2a5600b5"]]);export{He as default};
