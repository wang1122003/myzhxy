import{_ as be,r as i,a as $,aW as Te,S as Ve,b as he,o as Ee,d as N,e as P,h as c,f as t,w as r,v as d,m as l,l as q,aT as L,x as g,i as O,aP as Ce,j as v,k as S,T as j,U as y,g as G,y as J,A as Ue,z as W,B as _e,C as w,F as x,D as ke,H as Pe,a2 as xe,I as Ae,E as X,aX as K,az as ze,N as I,P as n,af as De}from"./index-gQMZQ2sp.js";/* empty css                   */import{T as Me,E as Be}from"./style-ssEox-hO.js";import{g as Fe,b as Se,d as Ie,u as He,e as Ye}from"./activity-CAs7x_u7.js";import{A as Re}from"./api-endpoints-Ctc2JoQP.js";import"./request-DfavLRg_.js";const $e={class:"activity-management-container"},Ne={class:"page-header"},qe={key:0,class:"pagination-container"},Le={style:{border:"1px solid #ccc"}},Oe={class:"dialog-footer"},je={class:"dialog-footer"},Ge=["src"],Je={name:"ActivityManagement"},We=Object.assign(Je,{setup(Xe){const A=i(!1),H=i([]),z=i(0),V=i(1),C=i(10),b=$({keyword:"",status:null}),T=i(!1),D=i("发布活动"),U=i(!1),_=i(!1),k=i(!1),M=i(!1),m=i(null),s=i({id:null,title:"",location:"",startTime:null,endTime:null,description:"",posterUrl:"",status:1}),f=i([]),B=i(!1),Y=i(""),Q=i(Re.UPLOAD_POSTER),Z=i({Authorization:`Bearer ${Te()}`}),p=Ve(),ee={},le={placeholder:"请输入活动详情..."},te=o=>{p.value=o};he(()=>{const o=p.value;o!=null&&o.destroy()});const ae=(o,e)=>{var u;o.code===200&&((u=o.data)!=null&&u.url)?(s.value.posterUrl=o.data.url,f.value=[{name:e.name,url:o.data.url}],n.success("封面上传成功")):(n.error(o.message||"封面上传失败"),f.value=[])},oe=(o,e)=>{s.value.posterUrl="",f.value=[]},re=o=>{Y.value=o.url||s.value.posterUrl,B.value=!0},se=o=>["image/jpeg","image/png","image/gif"].includes(o.type)?o.size/1024/1024>2?(n.error("封面图片大小不能超过 2MB!"),!1):!0:(n.error("封面图片只支持 JPG/PNG/GIF 格式!"),!1),ie=o=>{console.error("上传错误",o),n.error("上传失败")},ue=$({title:[{required:!0,message:"请输入活动标题",trigger:"blur"}],location:[{required:!0,message:"请输入活动地点",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"},{validator:(o,e,u)=>{s.value.startTime&&e&&new Date(e)<=new Date(s.value.startTime)?u(new Error("结束时间必须晚于开始时间")):u()},trigger:"change"}],description:[{required:!0,message:"请输入活动描述",trigger:"blur"},{validator:(o,e,u)=>{const a=p.value;a&&a.isEmpty()?u(new Error("请输入活动描述")):u()},trigger:"blur"}],status:[{required:!0,message:"请设置活动状态",trigger:"change"}]}),ne=()=>{m.value&&m.value.resetFields(),s.value={id:null,title:"",location:"",startTime:null,endTime:null,description:"",posterUrl:"",status:1},f.value=[],_.value=!1,k.value=!1},h=async()=>{A.value=!0;try{const o={page:V.value,size:C.value,keyword:b.keyword||null,status:b.status},e=await Fe(o);H.value=e.data.list||[],z.value=e.data.total||0}catch(o){console.error("获取活动列表失败",o),n.error("获取活动列表失败")}finally{A.value=!1}},R=()=>{V.value=1,h()},de=o=>{C.value=o,V.value=1,h()},ve=o=>{V.value=o,h()},pe=()=>{_.value=!1,D.value="发布活动",s.value={id:null,title:"",location:"",startTime:null,endTime:null,description:"",posterUrl:"",status:1},f.value=[],m.value&&m.value.clearValidate(),p.value&&p.value.setHtml(""),T.value=!0},me=async o=>{_.value=!0,D.value="编辑活动",k.value=!0,s.value={id:null,title:"",location:"",startTime:null,endTime:null,description:"",posterUrl:"",status:1},f.value=[],m.value&&m.value.clearValidate(),T.value=!0;try{const e=await Se(o.id);s.value={...e.data},s.value.posterUrl&&(f.value=[{name:"封面图",url:s.value.posterUrl}]),p.value&&p.value.setHtml(s.value.description||"")}catch(e){console.error("获取活动详情失败",e),n.error("获取活动详情失败"),T.value=!1}finally{k.value=!1}},fe=o=>{De.confirm(`确定要删除活动 ${o.title} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ie(o.id),n.success("删除成功"),h()}catch(e){console.error("删除活动失败",e),n.error("删除活动失败")}}).catch(()=>{n.info("已取消删除")})},ce=async o=>{U.value=!0,n.info(`查看活动 ${o.title} 报名情况功能待实现`)},ge=()=>{m.value.validate(async o=>{var e,u;if(o){M.value=!0;try{const a=p.value;if(!a)throw new Error("编辑器未初始化");const E={...s.value,description:a.getHtml()};_.value?(await He(E.id,E),n.success("活动更新成功")):(await Ye(E),n.success("活动发布成功")),T.value=!1,h()}catch(a){console.error("提交活动失败",a),n.error(((u=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:u.message)||"提交活动失败")}finally{M.value=!1}}else return console.log("活动表单验证失败"),!1})},ye=o=>{const e={1:"报名中",2:"进行中",3:"已结束",0:"已取消"};return e[o]!==void 0?e[o]:"未知"},we=o=>({1:"success",2:"warning",3:"info",0:"danger"})[o]||"info",F=o=>{if(!o)return"-";try{return new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return o}};return Ee(()=>{h()}),(o,e)=>{const u=Pe;return P(),N("div",$e,[c("div",Ne,[e[16]||(e[16]=c("h2",null,"活动管理",-1)),t(l(g),{type:"primary",onClick:pe},{default:r(()=>[t(l(q),null,{default:r(()=>[t(l(L))]),_:1}),e[15]||(e[15]=d(" 发布活动 "))]),_:1})]),t(l(G),{class:"filter-card"},{default:r(()=>[t(l(O),{inline:!0,model:b,onSubmit:Ce(R,["prevent"])},{default:r(()=>[t(l(v),{label:"关键词"},{default:r(()=>[t(l(S),{modelValue:b.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>b.keyword=a),clearable:"",placeholder:"活动标题/地点",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),t(l(v),{label:"状态"},{default:r(()=>[t(l(j),{modelValue:b.status,"onUpdate:modelValue":e[1]||(e[1]=a=>b.status=a),clearable:"",placeholder:"选择状态",style:{width:"120px"}},{default:r(()=>[t(l(y),{value:1,label:"报名中"}),t(l(y),{value:2,label:"进行中"}),t(l(y),{value:3,label:"已结束"}),t(l(y),{value:0,label:"已取消"})]),_:1},8,["modelValue"])]),_:1}),t(l(v),null,{default:r(()=>[t(l(g),{type:"primary",onClick:R},{default:r(()=>e[17]||(e[17]=[d(" 查询 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(l(G),{class:"activity-list-card"},{default:r(()=>[J((P(),W(l(_e),{data:H.value,style:{width:"100%"}},{default:r(()=>[t(l(w),{label:"活动标题","min-width":"200",prop:"title","show-overflow-tooltip":""}),t(l(w),{label:"活动地点",prop:"location",width:"150"}),t(l(w),{label:"开始时间",prop:"startTime",width:"180"},{default:r(a=>[d(x(F(a.row.startTime)),1)]),_:1}),t(l(w),{label:"结束时间",prop:"endTime",width:"180"},{default:r(a=>[d(x(F(a.row.endTime)),1)]),_:1}),t(l(w),{label:"报名人数",prop:"currentParticipants",width:"100"}),t(l(w),{label:"状态",prop:"status",width:"100"},{default:r(a=>[t(l(ke),{type:we(a.row.status)},{default:r(()=>[d(x(ye(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(l(w),{label:"发布时间",prop:"createTime",width:"180"},{default:r(a=>[d(x(F(a.row.createTime)),1)]),_:1}),t(l(w),{fixed:"right",label:"操作",width:"220"},{default:r(a=>[t(l(g),{size:"small",type:"success",onClick:E=>ce(a.row)},{default:r(()=>e[18]||(e[18]=[d(" 报名情况 ")])),_:2},1032,["onClick"]),t(l(g),{size:"small",type:"primary",onClick:E=>me(a.row)},{default:r(()=>e[19]||(e[19]=[d(" 编辑 ")])),_:2},1032,["onClick"]),t(l(g),{size:"small",type:"danger",onClick:E=>fe(a.row)},{default:r(()=>e[20]||(e[20]=[d(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[u,A.value]]),z.value>0?(P(),N("div",qe,[t(l(xe),{"current-page":V.value,"onUpdate:currentPage":e[2]||(e[2]=a=>V.value=a),"page-size":C.value,"onUpdate:pageSize":e[3]||(e[3]=a=>C.value=a),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ve},null,8,["current-page","page-size","total"])])):Ue("",!0)]),_:1}),t(l(I),{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=a=>T.value=a),"close-on-click-modal":!1,title:D.value,top:"5vh",width:"80%",onClose:ne},{footer:r(()=>[c("span",Oe,[t(l(g),{onClick:e[10]||(e[10]=a=>T.value=!1)},{default:r(()=>e[22]||(e[22]=[d("取消")])),_:1}),t(l(g),{loading:M.value,type:"primary",onClick:ge},{default:r(()=>e[23]||(e[23]=[d("确定")])),_:1},8,["loading"])])]),default:r(()=>[J((P(),W(l(O),{ref_key:"activityFormRef",ref:m,model:s.value,rules:ue,"label-width":"100px"},{default:r(()=>[t(l(v),{label:"活动标题",prop:"title"},{default:r(()=>[t(l(S),{modelValue:s.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.title=a),placeholder:"请输入活动标题"},null,8,["modelValue"])]),_:1}),t(l(v),{label:"活动地点",prop:"location"},{default:r(()=>[t(l(S),{modelValue:s.value.location,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.location=a),placeholder:"请输入活动地点"},null,8,["modelValue"])]),_:1}),t(l(Ae),{gutter:20},{default:r(()=>[t(l(X),{span:12},{default:r(()=>[t(l(v),{label:"开始时间",prop:"startTime"},{default:r(()=>[t(l(K),{modelValue:s.value.startTime,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.startTime=a),placeholder:"选择开始时间",style:{width:"100%"},type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),t(l(X),{span:12},{default:r(()=>[t(l(v),{label:"结束时间",prop:"endTime"},{default:r(()=>[t(l(K),{modelValue:s.value.endTime,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.endTime=a),placeholder:"选择结束时间",style:{width:"100%"},type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(l(v),{label:"活动描述",prop:"description"},{default:r(()=>[c("div",Le,[t(l(Me),{"default-config":ee,editor:p.value,mode:"default",style:{"border-bottom":"1px solid #ccc"}},null,8,["editor"]),t(l(Be),{modelValue:s.value.description,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.description=a),"default-config":le,mode:"default",style:{height:"300px","overflow-y":"hidden"},onOnCreated:te},null,8,["modelValue"])])]),_:1}),t(l(v),{label:"封面图片",prop:"posterUrl"},{default:r(()=>[t(l(ze),{action:Q.value,"before-upload":se,"file-list":f.value,headers:Z.value,limit:1,"on-error":ie,"on-preview":re,"on-remove":oe,"on-success":ae,"show-file-list":!0,"list-type":"picture-card"},{tip:r(()=>e[21]||(e[21]=[c("div",{class:"el-upload__tip"}," 只能上传一张封面图，建议尺寸 750x300，大小不超过 2MB ",-1)])),default:r(()=>[t(l(q),null,{default:r(()=>[t(l(L))]),_:1})]),_:1},8,["action","file-list","headers"])]),_:1}),t(l(v),{label:"状态",prop:"status"},{default:r(()=>[t(l(j),{modelValue:s.value.status,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.status=a),placeholder:"设置活动状态"},{default:r(()=>[t(l(y),{value:1,label:"报名中"}),t(l(y),{value:2,label:"进行中"}),t(l(y),{value:3,label:"已结束"}),t(l(y),{value:0,label:"已取消"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[u,k.value]])]),_:1},8,["modelValue","title"]),t(l(I),{modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=a=>U.value=a),title:"活动报名情况",width:"60%"},{footer:r(()=>[c("span",je,[t(l(g),{onClick:e[12]||(e[12]=a=>U.value=!1)},{default:r(()=>e[24]||(e[24]=[d("关闭")])),_:1})])]),default:r(()=>[e[25]||(e[25]=c("p",null,"报名列表待实现...",-1))]),_:1},8,["modelValue"]),t(l(I),{modelValue:B.value,"onUpdate:modelValue":e[14]||(e[14]=a=>B.value=a)},{default:r(()=>[c("img",{src:Y.value,alt:"Preview Image",style:{display:"block","max-width":"100%",margin:"0 auto"}},null,8,Ge)]),_:1},8,["modelValue"])])}}}),al=be(We,[["__scopeId","data-v-05e3e7c6"]]);export{al as default};
