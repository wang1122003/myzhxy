import{_ as Y,u as q,ad as K,r as y,a as G,o as Q,d as u,e as i,h as a,y as W,f as s,w as n,v as c,l as X,m as v,a7 as Z,x as tt,z as f,A as _,H as et,K as g,F as d,D as at,ah as st,aK as nt,p as ot,a0 as it,ai as b,Y as lt,J as rt,L,a4 as ct,g as dt,N as ut,P as m,af as N}from"./index-DrN7HJWs.js";/* empty css                   *//* empty css                   */import{b as _t,j as pt,c as vt}from"./activity-hBNT0O0-.js";import{d as ft}from"./file-DSgdrnhe.js";import"./request-BGbcGZqw.js";const mt={class:"activity-detail-container"},yt={class:"page-header"},gt={class:"back-button"},ht={class:"header-actions"},kt={class:"activity-header"},Et={class:"activity-title"},Tt={class:"activity-status"},Dt={class:"activity-cover"},wt=["src"],At={class:"activity-meta"},St={class:"meta-item"},Ct={class:"meta-item"},Lt={class:"meta-item"},xt={class:"meta-item"},Bt={class:"meta-item"},bt={key:0,class:"meta-item"},Nt=["innerHTML"],Rt={key:0,class:"activity-attachments"},Mt={class:"enrollment-info"},Ut={key:0},Vt={class:"participant-list"},$t={key:0,class:"more-participants"},It={class:"participants-dialog"},Ot={class:"participant-info"},jt={class:"participant-name"},zt={class:"participant-department"},Ft={class:"participant-status"},Ht={__name:"ActivityDetail",setup(Jt){const R=q(),M=K(),E=y(M.params.id),e=G({}),T=y(!0),D=y(!1),w=y(!1),A=y(null),S=y(!1),C=async()=>{T.value=!0;try{const o=await _t(E.value);o.code===200&&o.data?Object.assign(e,o.data):m.error(o.message||"获取活动详情失败")}catch(o){console.error("获取活动详情失败:",o),m.error("获取活动详情失败")}finally{T.value=!1}},U=o=>({ACADEMIC:"学术讲座",CULTURAL:"文化活动",SPORTS:"体育赛事",CAREER:"就业招聘",SOCIAL:"社交活动",VOLUNTEER:"志愿服务",OTHER:"其他"})[o]||"未知类型",x=o=>{if(!o)return"-";const t=new Date(o);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},V=o=>{if(!o)return"-";const t=new Date(o);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},$=()=>{R.push("/student/activities")},I=async()=>{var o,t;try{await N.confirm("确定要报名参加此活动吗？","报名确认",{confirmButtonText:"确定报名",cancelButtonText:"取消",type:"info"}),D.value=!0,await pt(E.value),m.success("报名成功"),C()}catch(r){r!=="cancel"&&(console.error("报名失败",r),m.error(((t=(o=r.response)==null?void 0:o.data)==null?void 0:t.message)||"报名失败"))}finally{D.value=!1}},O=async()=>{var o,t;try{await N.confirm("确定要取消报名此活动吗？","取消报名确认",{confirmButtonText:"确定取消",cancelButtonText:"返回",type:"warning"}),w.value=!0,await vt(E.value),m.success("已取消报名"),C()}catch(r){r!=="cancel"&&(console.error("取消报名失败",r),m.error(((t=(o=r.response)==null?void 0:o.data)==null?void 0:t.message)||"取消报名失败"))}finally{w.value=!1}},j=async o=>{A.value=o.id;try{const t=await ft(o.id),r=new Blob([t.data]),p=document.createElement("a");p.href=URL.createObjectURL(r),p.download=o.filename,p.click(),URL.revokeObjectURL(p.href),m.success("文件下载成功")}catch(t){console.error("文件下载失败",t),m.error("文件下载失败")}finally{A.value=null}},z=()=>{S.value=!0};return Q(()=>{C()}),(o,t)=>{const r=X,p=tt,h=at,k=rt,B=ct,F=dt,H=ut,J=et;return i(),u("div",mt,[a("div",yt,[a("div",gt,[s(p,{text:"",onClick:$},{default:n(()=>[s(r,null,{default:n(()=>[s(v(Z))]),_:1}),t[1]||(t[1]=c(" 返回活动列表 "))]),_:1})]),a("div",ht,[!e.enrolled&&e.status===1?(i(),f(p,{key:0,loading:D.value,type:"primary",onClick:I},{default:n(()=>t[2]||(t[2]=[c(" 立即报名 ")])),_:1},8,["loading"])):_("",!0),e.enrolled&&e.status===1?(i(),f(p,{key:1,loading:w.value,type:"danger",onClick:O},{default:n(()=>t[3]||(t[3]=[c(" 取消报名 ")])),_:1},8,["loading"])):_("",!0)])]),W((i(),f(F,{class:"activity-detail-card",shadow:"hover"},{default:n(()=>[e.id?(i(),u(g,{key:0},[a("div",kt,[a("h1",Et,d(e.title),1),a("div",Tt,[e.status===1?(i(),f(h,{key:0,type:"success"},{default:n(()=>t[4]||(t[4]=[c(" 报名中 ")])),_:1})):e.status===2?(i(),f(h,{key:1,type:"warning"},{default:n(()=>t[5]||(t[5]=[c(" 进行中 ")])),_:1})):e.status===3?(i(),f(h,{key:2,type:"info"},{default:n(()=>t[6]||(t[6]=[c(" 已结束 ")])),_:1})):_("",!0)])]),a("div",Dt,[a("img",{src:e.coverImage||"https://via.placeholder.com/800x300",alt:"活动封面"},null,8,wt)]),a("div",At,[a("div",St,[s(r,null,{default:n(()=>[s(v(st))]),_:1}),a("span",null,"活动时间："+d(x(e.startTime))+" 至 "+d(x(e.endTime)),1)]),a("div",Ct,[s(r,null,{default:n(()=>[s(v(nt))]),_:1}),a("span",null,"活动地点："+d(e.location),1)]),a("div",Lt,[s(r,null,{default:n(()=>[s(v(ot))]),_:1}),a("span",null,"主办方："+d(e.organizer),1)]),a("div",xt,[s(r,null,{default:n(()=>[s(v(it))]),_:1}),a("span",null,"活动类型："+d(U(e.type)),1)]),a("div",Bt,[s(r,null,{default:n(()=>[s(v(b))]),_:1}),a("span",null,"报名人数："+d(e.enrolledCount||0),1)]),e.quota?(i(),u("div",bt,[s(r,null,{default:n(()=>[s(v(lt))]),_:1}),a("span",null,"可获学分："+d(e.quota),1)])):_("",!0)]),s(k,{"content-position":"left"},{default:n(()=>t[7]||(t[7]=[c(" 活动详情 ")])),_:1}),a("div",{class:"activity-content",innerHTML:e.description},null,8,Nt),e.attachments&&e.attachments.length>0?(i(),u("div",Rt,[s(k,{"content-position":"left"},{default:n(()=>t[8]||(t[8]=[c(" 活动资料 ")])),_:1}),(i(!0),u(g,null,L(e.attachments,(l,P)=>(i(),u("div",{key:P,class:"attachment-item"},[s(p,{loading:A.value===l.id,link:"",type:"primary",onClick:Pt=>j(l)},{default:n(()=>[s(r,null,{default:n(()=>[s(v(b))]),_:1}),c(" "+d(l.filename),1)]),_:2},1032,["loading","onClick"])]))),128))])):_("",!0),e.enrolled?(i(),u(g,{key:1},[s(k,{"content-position":"left"},{default:n(()=>t[9]||(t[9]=[c(" 报名信息 ")])),_:1}),a("div",Mt,[t[11]||(t[11]=a("p",null,"您已成功报名此活动！",-1)),a("p",null,"报名时间："+d(V(e.enrollTime)),1),e.participationStatus?(i(),u("div",Ut,[a("p",null,[t[10]||(t[10]=c(" 参与状态： ")),s(h,{type:e.participationStatus==="ATTENDED"?"success":"info"},{default:n(()=>[c(d(e.participationStatus==="ATTENDED"?"已参加":e.participationStatus==="ABSENT"?"未参加":"待确认"),1)]),_:1},8,["type"])])])):_("",!0)])],64)):_("",!0),e.participants&&e.participants.length>0?(i(),u(g,{key:2},[s(k,{"content-position":"left"},{default:n(()=>t[12]||(t[12]=[c(" 参与人员 ")])),_:1}),a("div",Vt,[(i(!0),u(g,null,L(e.participants,l=>(i(),f(B,{key:l.id,size:50,src:l.avatar,class:"participant-avatar"},{default:n(()=>[c(d(l.name?l.name.substring(0,1):"U"),1)]),_:2},1032,["src"]))),128)),e.participants.length>=10?(i(),u("div",$t,[s(p,{text:"",onClick:z},{default:n(()=>t[13]||(t[13]=[c(" 查看全部 ")])),_:1})])):_("",!0)])],64)):_("",!0)],64)):_("",!0)]),_:1})),[[J,T.value]]),s(H,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=l=>S.value=l),title:"活动参与人员",width:"50%"},{default:n(()=>[a("div",It,[(i(!0),u(g,null,L(e.participants,l=>(i(),u("div",{key:l.id,class:"participant-item"},[s(B,{size:40,src:l.avatar},{default:n(()=>[c(d(l.name?l.name.substring(0,1):"U"),1)]),_:2},1032,["src"]),a("div",Ot,[a("div",jt,d(l.name),1),a("div",zt,d(l.department||"未知院系"),1)]),a("div",Ft,[l.status?(i(),f(h,{key:0,type:l.status==="ATTENDED"?"success":"info",size:"small"},{default:n(()=>[c(d(l.status==="ATTENDED"?"已参加":"已报名"),1)]),_:2},1032,["type"])):_("",!0)])]))),128))])]),_:1},8,["modelValue"])])}}},Xt=Y(Ht,[["__scopeId","data-v-127c2a2d"]]);export{Xt as default};
