import{_ as J,ad as Q,u as X,c as h,r as n,o as Y,d as S,e as u,f as r,y as Z,m as t,aN as ee,H as ae,z as p,w as s,h as w,A as I,az as te,x as B,v as f,l as $,ay as oe,B as re,C as g,ai as se,aO as le,ak as ne,F as k,a2 as ie,G as ue,g as de,P as i,af as ce}from"./index-gQMZQ2sp.js";/* empty css                   */import{a as pe,d as fe,b as ge}from"./file-Ck7nKFvu.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const me={class:"course-resources-container"},ve={class:"card-header"},he={class:"file-name"},we={key:0,class:"pagination-container"},ye=Object.assign({name:"CourseResources"},{__name:"CourseResources",setup(_e){const b=Q(),L=X(),E=h(()=>b.params.courseId),M=h(()=>b.query.courseName||"未命名课程"),m=n(!1),y=n([]),_=n(0),d=n(1),v=n(10),x=n(null),C=n(null),z=n([]),N=h(()=>`http://localhost:8080/campus/api/file/upload/course/material/${E.value}`),T=h(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),c=async()=>{var e,a;m.value=!0;try{const l=await pe({courseId:E.value,page:d.value,size:v.value});y.value=((e=l.data)==null?void 0:e.list)||[],_.value=((a=l.data)==null?void 0:a.total)||0}catch(l){console.error("获取课程资源失败",l),i.error("获取课程资源失败")}finally{m.value=!1}},U=e=>e.size/1024/1024<20?!0:(i.error("文件大小不能超过20MB!"),!1),D=(e,a)=>{console.log("上传进度:",Math.round(e.percent)+"%")},F=(e,a)=>{i.success(`文件 ${a.name} 上传成功`),c(),z.value=[]},R=(e,a)=>{console.error("上传失败",e),i.error(`文件 ${a.name} 上传失败`)},P=async e=>{x.value=e.id;try{await fe(e.id),i.success("文件下载成功")}catch(a){console.error("文件下载失败",a),i.error("文件下载失败")}finally{x.value=null}},j=e=>{ce.confirm(`确定要删除文件 ${e.filename}?`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{C.value=e.id;try{await ge(e.id),i.success("文件删除成功"),c()}catch(a){console.error("文件删除失败",a),i.error("文件删除失败")}finally{C.value=null}}).catch(()=>{})},V=e=>e?e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":e<1024*1024*1024?(e/1024/1024).toFixed(1)+" MB":(e/1024/1024/1024).toFixed(1)+" GB":"未知",H=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未知",A=e=>e?[".doc",".docx",".pdf",".xls",".xlsx",".ppt",".pptx",".txt"].some(l=>e.toLowerCase().endsWith(l)):!1,G=e=>e?[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(l=>e.toLowerCase().endsWith(l)):!1,O=()=>{L.push({name:"TeacherCourses"})},W=e=>{v.value=e,d.value=1,c()},q=e=>{d.value=e,c()};return Y(()=>{c()}),(e,a)=>{const l=ae;return u(),S("div",me,[r(t(ee),{title:`课程资源管理 - ${M.value}`,onBack:O},null,8,["title"]),Z((u(),p(t(de),{class:"resource-card"},{default:s(()=>[w("div",ve,[a[3]||(a[3]=w("h3",null,"课程资源列表",-1)),r(t(te),{action:N.value,"before-upload":U,"file-list":z.value,headers:T.value,limit:5,"on-error":R,"on-progress":D,"on-success":F,multiple:""},{default:s(()=>[r(t(B),{type:"primary"},{default:s(()=>[r(t($),null,{default:s(()=>[r(t(oe))]),_:1}),a[2]||(a[2]=f(" 上传课程资源 "))]),_:1})]),_:1},8,["action","file-list","headers"])]),r(t(re),{data:y.value,border:"",style:{width:"100%","margin-top":"20px"}},{default:s(()=>[r(t(g),{label:"文件名","min-width":"200",prop:"filename"},{default:s(o=>[w("div",he,[r(t($),{class:"file-icon"},{default:s(()=>[A(o.row.filename)?(u(),p(t(se),{key:0})):G(o.row.filename)?(u(),p(t(le),{key:1})):(u(),p(t(ne),{key:2}))]),_:2},1024),w("span",null,k(o.row.filename),1)])]),_:1}),r(t(g),{label:"大小",prop:"fileSize",width:"120"},{default:s(o=>[f(k(V(o.row.fileSize)),1)]),_:1}),r(t(g),{label:"上传时间",prop:"uploadTime",width:"180"},{default:s(o=>[f(k(H(o.row.uploadTime)),1)]),_:1}),r(t(g),{label:"下载次数",prop:"downloadCount",width:"100"}),r(t(g),{fixed:"right",label:"操作",width:"200"},{default:s(o=>[r(t(B),{loading:x.value===o.row.id,size:"small",type:"primary",onClick:K=>P(o.row)},{default:s(()=>a[4]||(a[4]=[f(" 下载 ")])),_:2},1032,["loading","onClick"]),r(t(B),{loading:C.value===o.row.id,size:"small",type:"danger",onClick:K=>j(o.row)},{default:s(()=>a[5]||(a[5]=[f(" 删除 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"]),_.value>0?(u(),S("div",we,[r(t(ie),{"current-page":d.value,"onUpdate:currentPage":a[0]||(a[0]=o=>d.value=o),"page-size":v.value,"onUpdate:pageSize":a[1]||(a[1]=o=>v.value=o),"page-sizes":[10,20,50],total:_.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:q},null,8,["current-page","page-size","total"])])):I("",!0),y.value.length===0&&!m.value?(u(),p(t(ue),{key:1,description:"暂无课程资源"})):I("",!0)]),_:1})),[[l,m.value]])])}}}),Ee=J(ye,[["__scopeId","data-v-3c93a05a"]]);export{Ee as default};
