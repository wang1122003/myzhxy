import{_ as D,R as g,d as U,e as u,f as l,w as o,y as V,z as m,A as j,i as I,j as M,k as N,T as R,U as A,x as O,v as r,B as G,C as H,l as K,M as Z,F as p,G as q,H as J,a2 as Q,h as y,g as W}from"./index-DrN7HJWs.js";/* empty css                        *//* empty css                */import{c as X,d as Y,e as $,l as ee}from"./file-DSgdrnhe.js";import"./request-BGbcGZqw.js";var te={};const le={name:"FileManager",data(){return{loading:!1,uploading:!1,fileList:[],currentPath:"",selectedFiles:[],showStats:!0,fileStats:null,uploadUrl:(te.VUE_APP_BASE_API||"")+"/file/upload/document",filters:{filename:"",uploaderName:"",fileType:""},total:0,currentPage:1,pageSize:10,downloadLoading:null,deleteLoading:null}},created(){this.loadFileList(),this.loadFileStats()},computed:{pathSegments(){return this.currentPath?this.currentPath.split("/").filter(e=>e):[]}},methods:{cleanPathPrefix(e){if(typeof e!="string")return e;const t=/^\/[a-zA-Z]:/;return t.test(e)?e.replace(t,""):e},loadFileList(){this.loading=!0;const e=this.cleanPathPrefix(this.currentPath);ee(e).then(t=>{t.code===200&&t.data?(this.fileList=t.data.files||[],this.currentPath=this.cleanPathPrefix(t.data.currentPath),this.total=t.data.totalCount):this.$message.error(t.message||"获取文件列表失败")}).catch(t=>{console.error("加载文件列表失败",t),this.$message.error("加载文件列表失败: "+(t.message||t))}).finally(()=>{this.loading=!1})},loadFileStats(){$().then(e=>{e.code===200&&(this.fileStats=e.data)}).catch(e=>{console.error("获取文件统计失败",e)})},fetchFiles(){this.currentPage=1,this.loadFileList()},handleDownload(e){if(e.isDirectory)return;const t=e.path;this.downloadLoading=e.id,Y({filePath:t}).then(n=>{const _=new Blob([n],{type:"application/octet-stream"}),i=document.createElement("a");i.href=URL.createObjectURL(_),i.download=e.filename,i.click(),URL.revokeObjectURL(i.href),this.$message.success("下载成功")}).catch(n=>{console.error("下载文件失败",n),this.$message.error("下载文件失败: "+(n.message||n))}).finally(()=>{this.downloadLoading=null})},handleDelete(e){this.deleteLoading=e.id,this.$confirm(`确定要删除 ${e.filename} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteFiles([e.path])}).catch(()=>{}).finally(()=>{this.deleteLoading=null})},confirmDeleteFiles(){this.selectedFiles.length!==0&&this.$confirm(`确定要删除选中的 ${this.selectedFiles.length} 个文件吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=this.selectedFiles.map(t=>t.path);this.deleteFiles(e)}).catch(()=>{})},deleteFiles(e){this.loading=!0,X(e).then(t=>{t.code===200?(this.$message.success("删除成功"),this.loadFileList(),this.loadFileStats()):this.$message.error(t.message||"删除失败")}).catch(t=>{console.error("删除文件失败",t),this.$message.error("删除文件失败: "+(t.message||t))}).finally(()=>{this.loading=!1})},enterDirectory(e){const t=this.currentPath?`${this.currentPath}/${e}`:e;this.currentPath=this.cleanPathPrefix(t),this.loadFileList()},navigateToPath(e){this.currentPath=this.cleanPathPrefix(e),this.loadFileList()},generatePath(e){return this.pathSegments.slice(0,e+1).join("/")},beforeUpload(){return this.uploading=!0,!0},handleUploadSuccess(e){this.uploading=!1,e.code===200?(this.$message.success("文件上传成功"),this.loadFileList(),this.loadFileStats()):this.$message.error(e.message||"上传失败")},handleUploadError(e){this.uploading=!1,console.error("上传文件失败",e),this.$message.error("上传文件失败: "+(e.message||e))},handleSelectionChange(e){this.selectedFiles=e},formatFileSize(e){if(e===0)return"0 B";const t=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,n)).toFixed(2)+" "+t[n]},formatDateTime(e){return new Date(e).toLocaleString()},getFileIcon(e){if(!e)return"el-icon-document";const t=e.split(".").pop().toLowerCase(),n={jpg:"el-icon-picture",jpeg:"el-icon-picture",png:"el-icon-picture",gif:"el-icon-picture",bmp:"el-icon-picture",svg:"el-icon-picture",doc:"el-icon-document",docx:"el-icon-document",pdf:"el-icon-document",txt:"el-icon-document-copy",md:"el-icon-document-copy",xls:"el-icon-tickets",xlsx:"el-icon-tickets",csv:"el-icon-tickets",zip:"el-icon-suitcase",rar:"el-icon-suitcase","7z":"el-icon-suitcase",tar:"el-icon-suitcase",gz:"el-icon-suitcase",mp3:"el-icon-headset",wav:"el-icon-headset",ogg:"el-icon-headset",mp4:"el-icon-video-camera",avi:"el-icon-video-camera",mov:"el-icon-video-camera",wmv:"el-icon-video-camera",js:"el-icon-s-order",css:"el-icon-s-order",html:"el-icon-s-order",java:"el-icon-s-order",py:"el-icon-s-order",default:"el-icon-document"};return n[t]||n.default},getFileType(e){if(!e)return"未知"}}},ae={class:"file-management-container"};function ie(e,t,n,_,i,c){const w=N,h=M,s=A,F=R,f=O,v=I,P=g("Document"),b=g("Picture"),S=g("Files"),L=K,C=Z,d=H,k=q,x=G,z=Q,T=W,E=J;return u(),U("div",ae,[l(T,{class:"page-container"},{header:o(()=>t[5]||(t[5]=[y("div",{class:"header"},[y("span",null,"文件管理")],-1)])),default:o(()=>[l(v,{inline:!0,model:i.filters,class:"filter-form"},{default:o(()=>[l(h,{label:"文件名"},{default:o(()=>[l(w,{modelValue:i.filters.filename,"onUpdate:modelValue":t[0]||(t[0]=a=>i.filters.filename=a),clearable:"",placeholder:"输入文件名关键词"},null,8,["modelValue"])]),_:1}),l(h,{label:"上传者"},{default:o(()=>[l(w,{modelValue:i.filters.uploaderName,"onUpdate:modelValue":t[1]||(t[1]=a=>i.filters.uploaderName=a),clearable:"",placeholder:"输入上传者姓名/ID"},null,8,["modelValue"])]),_:1}),l(h,{label:"文件类型"},{default:o(()=>[l(F,{modelValue:i.filters.fileType,"onUpdate:modelValue":t[2]||(t[2]=a=>i.filters.fileType=a),clearable:"",placeholder:"选择文件类型"},{default:o(()=>[l(s,{label:"全部",value:""}),l(s,{label:"文档",value:"document"}),l(s,{label:"图片",value:"image"}),l(s,{label:"视频",value:"video"}),l(s,{label:"音频",value:"audio"}),l(s,{label:"压缩包",value:"archive"}),l(s,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(h,null,{default:o(()=>[l(f,{icon:e.Search,type:"primary",onClick:c.fetchFiles},{default:o(()=>t[6]||(t[6]=[r("查询")])),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["model"]),V((u(),m(x,{data:i.fileList,style:{width:"100%"},border:"",size:"small",stripe:""},{empty:o(()=>[l(k,{description:"暂无文件数据"})]),default:o(()=>[l(d,{label:"文件名",prop:"filename","min-width":"250","show-overflow-tooltip":""},{default:o(a=>[l(L,{style:{"vertical-align":"middle","margin-right":"5px"}},{default:o(()=>[e.isDocument(a.row.filename)?(u(),m(P,{key:0})):e.isImage(a.row.filename)?(u(),m(b,{key:1})):(u(),m(S,{key:2}))]),_:2},1024),l(C,{href:e.getFilePreviewUrl(a.row),target:"_blank",type:"primary",underline:!1},{default:o(()=>[r(p(a.row.filename),1)]),_:2},1032,["href"])]),_:1}),l(d,{label:"大小",prop:"fileSize",width:"120"},{default:o(a=>[r(p(c.formatFileSize(a.row.fileSize)),1)]),_:1}),l(d,{label:"类型",prop:"fileType",width:"100"},{default:o(a=>[r(p(c.getFileType(a.row.filename)),1)]),_:1}),l(d,{label:"上传者",prop:"uploaderName",width:"120"}),l(d,{label:"上传时间",prop:"uploadTime",width:"180"},{default:o(a=>[r(p(c.formatDateTime(a.row.uploadTime)),1)]),_:1}),l(d,{fixed:"right",label:"操作",width:"150"},{default:o(a=>[l(f,{loading:i.downloadLoading===a.row.id,size:"small",type:"primary",onClick:B=>c.handleDownload(a.row)},{default:o(()=>t[7]||(t[7]=[r(" 下载 ")])),_:2},1032,["loading","onClick"]),l(f,{loading:i.deleteLoading===a.row.id,size:"small",type:"danger",onClick:B=>c.handleDelete(a.row)},{default:o(()=>t[8]||(t[8]=[r(" 删除 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[E,i.loading]]),i.total>0?(u(),m(z,{key:0,"current-page":i.currentPage,"onUpdate:currentPage":t[3]||(t[3]=a=>i.currentPage=a),"page-size":i.pageSize,"onUpdate:pageSize":t[4]||(t[4]=a=>i.pageSize=a),"page-sizes":[10,20,50,100],total:i.total,class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])):j("",!0)]),_:1})])}const de=D(le,[["render",ie],["__scopeId","data-v-3824ef4c"]]);export{de as default};
