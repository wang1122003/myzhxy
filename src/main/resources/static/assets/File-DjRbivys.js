import{_ as x,d as _,e as d,h as o,f as n,z as p,A as g,w as i,b0 as L,v as c,K as B,L as D,F as h,b1 as z,x as E,az as U,B as T,C as M,g as j,y as A,H as I,a8 as b,G as R}from"./index-gQMZQ2sp.js";/* empty css                   *//* empty css                        *//* empty css               *//* empty css                    */import{c as V,e as O,f as N,l as G}from"./file-Ck7nKFvu.js";import{F as K}from"./api-endpoints-Ctc2JoQP.js";import"./request-DfavLRg_.js";var H={};const Z={name:"FileManager",data(){return{loading:!1,uploading:!1,fileList:[],currentPath:"",selectedFiles:[],showStats:!0,fileStats:null,uploadUrl:H.VUE_APP_BASE_API+K.UPLOAD_DOCUMENT}},created(){this.loadFileList(),this.loadFileStats()},computed:{pathSegments(){return this.currentPath?this.currentPath.split("/").filter(t=>t):[]}},methods:{cleanPathPrefix(t){if(typeof t!="string")return t;const e=/^\/[a-zA-Z]:/;return e.test(t)?t.replace(e,""):t},loadFileList(){this.loading=!0;const t=this.cleanPathPrefix(this.currentPath);G(t).then(e=>{e.code===200&&e.data?(this.fileList=e.data.files||[],this.currentPath=this.cleanPathPrefix(e.data.currentPath)):this.$message.error(e.message||"获取文件列表失败")}).catch(e=>{console.error("加载文件列表失败",e),this.$message.error("加载文件列表失败: "+(e.message||e))}).finally(()=>{this.loading=!1})},loadFileStats(){N().then(t=>{t.code===200&&(this.fileStats=t.data)}).catch(t=>{console.error("获取文件统计失败",t)})},refreshFileList(){this.loadFileList()},downloadFile(t){if(t.isDirectory)return;const e=t.path;O(e).then(r=>{const y=new Blob([r],{type:"application/octet-stream"}),l=document.createElement("a");l.href=URL.createObjectURL(y),l.download=t.name,l.click(),URL.revokeObjectURL(l.href),this.$message.success("下载成功")}).catch(r=>{console.error("下载文件失败",r),this.$message.error("下载文件失败: "+(r.message||r))})},confirmDeleteFile(t){this.$confirm(`确定要删除 ${t.name} 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteFiles([t.path])}).catch(()=>{})},confirmDeleteFiles(){this.selectedFiles.length!==0&&this.$confirm(`确定要删除选中的 ${this.selectedFiles.length} 个文件吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=this.selectedFiles.map(e=>e.path);this.deleteFiles(t)}).catch(()=>{})},deleteFiles(t){this.loading=!0,V(t).then(e=>{e.code===200?(this.$message.success("删除成功"),this.loadFileList(),this.loadFileStats()):this.$message.error(e.message||"删除失败")}).catch(e=>{console.error("删除文件失败",e),this.$message.error("删除文件失败: "+(e.message||e))}).finally(()=>{this.loading=!1})},enterDirectory(t){const e=this.currentPath?`${this.currentPath}/${t}`:t;this.currentPath=this.cleanPathPrefix(e),this.loadFileList()},navigateToPath(t){this.currentPath=this.cleanPathPrefix(t),this.loadFileList()},generatePath(t){return this.pathSegments.slice(0,t+1).join("/")},beforeUpload(){return this.uploading=!0,!0},handleUploadSuccess(t){this.uploading=!1,t.code===200?(this.$message.success("文件上传成功"),this.loadFileList(),this.loadFileStats()):this.$message.error(t.message||"上传失败")},handleUploadError(t){this.uploading=!1,console.error("上传文件失败",t),this.$message.error("上传文件失败: "+(t.message||t))},handleSelectionChange(t){this.selectedFiles=t},formatFileSize(t){if(t===0)return"0 B";const e=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,r)).toFixed(2)+" "+e[r]},formatDate(t){return new Date(t).toLocaleString()},getFileIcon(t){if(!t)return"el-icon-document";const e=t.split(".").pop().toLowerCase(),r={jpg:"el-icon-picture",jpeg:"el-icon-picture",png:"el-icon-picture",gif:"el-icon-picture",bmp:"el-icon-picture",svg:"el-icon-picture",doc:"el-icon-document",docx:"el-icon-document",pdf:"el-icon-document",txt:"el-icon-document-copy",md:"el-icon-document-copy",xls:"el-icon-tickets",xlsx:"el-icon-tickets",csv:"el-icon-tickets",zip:"el-icon-suitcase",rar:"el-icon-suitcase","7z":"el-icon-suitcase",tar:"el-icon-suitcase",gz:"el-icon-suitcase",mp3:"el-icon-headset",wav:"el-icon-headset",ogg:"el-icon-headset",mp4:"el-icon-video-camera",avi:"el-icon-video-camera",mov:"el-icon-video-camera",wmv:"el-icon-video-camera",js:"el-icon-s-order",css:"el-icon-s-order",html:"el-icon-s-order",java:"el-icon-s-order",py:"el-icon-s-order",default:"el-icon-document"};return r[e]||r.default}}},q={class:"file-manager"},J={class:"file-tools"},Q={key:0,class:"stats-content"},W={class:"stats-item"},X={class:"stats-value"},Y={class:"stats-item"},$={class:"stats-value"},ee={key:0,class:"stats-types"},te={class:"file-list"},le={class:"file-name-cell"},se=["onClick"];function ie(t,e,r,y,l,a){const F=L,w=z,f=E,S=U,u=M,v=T,P=j,k=R,C=I;return d(),_("div",q,[e[13]||(e[13]=o("h1",null,"文件管理",-1)),n(w,{class:"path-breadcrumb",separator:"/"},{default:i(()=>[n(F,{to:{path:""},onClick:e[0]||(e[0]=s=>a.navigateToPath(""))},{default:i(()=>e[2]||(e[2]=[c("根目录")])),_:1}),(d(!0),_(B,null,D(a.pathSegments,(s,m)=>(d(),p(F,{key:m,onClick:ae=>a.navigateToPath(a.generatePath(m))},{default:i(()=>[c(h(s),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o("div",J,[n(S,{action:l.uploadUrl,"before-upload":a.beforeUpload,disabled:l.uploading,"on-error":a.handleUploadError,"on-success":a.handleUploadSuccess,"show-file-list":!1,class:"file-uploader",multiple:""},{default:i(()=>[n(f,{loading:l.uploading,type:"primary"},{default:i(()=>e[3]||(e[3]=[o("i",{class:"el-icon-upload"},null,-1),c(" 上传文件 ")])),_:1},8,["loading"])]),_:1},8,["action","before-upload","disabled","on-error","on-success"]),n(f,{disabled:l.selectedFiles.length===0,type:"danger",onClick:a.confirmDeleteFiles},{default:i(()=>e[4]||(e[4]=[o("i",{class:"el-icon-delete"},null,-1),c(" 删除选中 ")])),_:1},8,["disabled","onClick"]),n(f,{type:"info",onClick:a.refreshFileList},{default:i(()=>e[5]||(e[5]=[o("i",{class:"el-icon-refresh"},null,-1),c(" 刷新 ")])),_:1},8,["onClick"])]),l.showStats?(d(),p(P,{key:0,class:"stats-card"},{header:i(()=>[e[7]||(e[7]=o("span",null,"文件统计",-1)),n(f,{style:{float:"right",padding:"3px 0"},type:"link",onClick:e[1]||(e[1]=s=>l.showStats=!1)},{default:i(()=>e[6]||(e[6]=[c(" 隐藏 ")])),_:1})]),default:i(()=>[l.fileStats?(d(),_("div",Q,[o("div",W,[e[8]||(e[8]=o("div",{class:"stats-label"},"总文件数:",-1)),o("div",X,h(l.fileStats.totalCount)+" 个文件",1)]),o("div",Y,[e[9]||(e[9]=o("div",{class:"stats-label"},"总容量:",-1)),o("div",$,h(a.formatFileSize(l.fileStats.totalSize)),1)]),l.fileStats.typeStats&&l.fileStats.typeStats.length>0?(d(),_("div",ee,[e[10]||(e[10]=o("h4",null,"文件类型分布:",-1)),n(v,{data:l.fileStats.typeStats.slice(0,5),border:"",size:"small",stripe:""},{default:i(()=>[n(u,{label:"类型",prop:"type",width:"100"}),n(u,{label:"数量",prop:"count",width:"80"}),n(u,{label:"大小",prop:"size"},{default:i(s=>[c(h(a.formatFileSize(s.row.size)),1)]),_:1})]),_:1},8,["data"])])):g("",!0)])):g("",!0)]),_:1})):g("",!0),o("div",te,[A((d(),p(v,{data:l.fileList,style:{width:"100%"},onSelectionChange:a.handleSelectionChange},{default:i(()=>[n(u,{type:"selection",width:"55"}),n(u,{label:"名称","min-width":"200"},{default:i(s=>[o("div",le,[o("i",{class:b([s.row.isDirectory?"el-icon-folder":a.getFileIcon(s.row.name),"file-icon"])},null,2),o("span",{class:b([{"folder-name":s.row.isDirectory},"file-name"]),onClick:m=>s.row.isDirectory?a.enterDirectory(s.row.name):""},h(s.row.name),11,se)])]),_:1}),n(u,{label:"大小",prop:"size",width:"120"},{default:i(s=>[c(h(s.row.isDirectory?"-":a.formatFileSize(s.row.size)),1)]),_:1}),n(u,{label:"修改时间",prop:"lastModified",width:"180"},{default:i(s=>[c(h(a.formatDate(s.row.lastModified)),1)]),_:1}),n(u,{label:"操作",width:"180"},{default:i(s=>[s.row.isDirectory?g("",!0):(d(),p(f,{key:0,size:"small",type:"primary",onClick:m=>a.downloadFile(s.row)},{default:i(()=>e[11]||(e[11]=[c(" 下载 ")])),_:2},1032,["onClick"])),n(f,{size:"small",type:"danger",onClick:m=>a.confirmDeleteFile(s.row)},{default:i(()=>e[12]||(e[12]=[c(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[C,l.loading]])]),l.fileList.length===0&&!l.loading?(d(),p(k,{key:1,description:"当前目录为空"})):g("",!0)])}const me=x(Z,[["render",ie],["__scopeId","data-v-2b6fe34e"]]);export{me as default};
