import{_ as ce,u as pe,r as n,c as fe,o as ge,d as k,e as r,h as d,f as o,w as s,m as l,x as F,v as p,l as D,ay as ve,az as me,aK as K,y as G,A as L,z as i,B as H,C as u,ai as W,aO as Y,ak as q,F as g,H as he,a2 as J,G as Q,T as we,K as ye,L as _e,U as Ce,aL as be,P as c,af as xe}from"./index-gQMZQ2sp.js";/* empty css                   */import{F as ze}from"./api-endpoints-Ctc2JoQP.js";import{g as Se,a as ke,d as Fe,b as Le}from"./file-Ck7nKFvu.js";import{g as Ee}from"./course-DXTLIjhn.js";import"./request-DfavLRg_.js";const Te={class:"files-container"},Ue={class:"page-header"},Be={class:"actions"},Me={class:"file-list-container"},Pe={class:"file-name"},$e={key:0,class:"pagination-container"},De={class:"course-resource-container"},Ve={class:"filter-container"},Ie={class:"file-name"},je={key:0,class:"pagination-container"},Re={name:"FileManagement"},Ne=Object.assign(Re,{setup(Ae){pe();const y=n(!1),_=n([]),E=n(0),h=n(1),C=n(10),b=n(null),T=n(null),U=n("personal"),x=n([]),z=n(!1),B=n(0),v=n(1),S=n(10),M=n([]),P=n(null),$=n(!1),X=`http://localhost:8080/campus/api${ze.UPLOAD_FILE||"/file/upload"}`,Z=fe(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),m=async()=>{y.value=!0;try{const e=await Se({page:h.value,size:C.value,type:"personal"});_.value=e.data.list||[],E.value=e.data.total||0}catch(e){console.error("获取文件列表失败",e),c.error("获取文件列表失败")}finally{y.value=!1}},w=async()=>{z.value=!0;try{const e=await ke({page:v.value,size:S.value,courseId:P.value});x.value=e.data.list||[],B.value=e.data.total||0}catch(e){console.error("获取课程资源失败",e),c.error("获取课程资源失败")}finally{z.value=!1}},V=async()=>{$.value=!0;try{const e=await Ee();M.value=e.data||[]}catch(e){console.error("获取课程列表失败",e)}finally{$.value=!1}},ee=e=>{e.code===200?(c.success("上传成功"),m()):c.error(e.message||"上传失败")},ae=e=>{console.error("上传失败",e),c.error("上传失败，请检查网络或文件大小")},te=e=>e.size/1024/1024<20?!0:(c.error("文件大小不能超过20MB!"),!1),I=async e=>{b.value=e.id;try{await Fe(e.id),c.success("文件下载成功")}catch(t){console.error("文件下载失败",t),c.error("文件下载失败")}finally{b.value=null}},le=e=>{xe.confirm("确定要删除该文件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{T.value=e.id;try{await Le(e.id),c.success("文件删除成功"),m()}catch(t){console.error("文件删除失败",t),c.error("文件删除失败")}finally{T.value=null}}).catch(()=>{})},oe=e=>{C.value=e,h.value=1,m()},se=e=>{h.value=e,m()},ne=e=>{S.value=e,v.value=1,w()},re=e=>{v.value=e,w()},ie=()=>{v.value=1,w()},ue=e=>{e.props.name==="course"?(M.value.length===0&&V(),x.value.length===0&&w()):e.props.name==="personal"&&_.value.length===0&&m()},j=e=>e<1024?e+"B":e<1024*1024?(e/1024).toFixed(2)+"KB":e<1024*1024*1024?(e/(1024*1024)).toFixed(2)+"MB":(e/(1024*1024*1024)).toFixed(2)+"GB",R=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},N=e=>[".doc",".docx",".pdf",".xls",".xlsx",".ppt",".pptx",".txt"].some(f=>e.toLowerCase().endsWith(f)),A=e=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(f=>e.toLowerCase().endsWith(f)),de=e=>{if(!e)return"未知";const t=e.split(".").pop().toLowerCase();return{doc:"文档",docx:"文档",pdf:"PDF",xls:"表格",xlsx:"表格",ppt:"演示文稿",pptx:"演示文稿",txt:"文本",jpg:"图片",jpeg:"图片",png:"图片",gif:"图片",bmp:"图片",webp:"图片",mp4:"视频",avi:"视频",mov:"视频",mp3:"音频",wav:"音频",zip:"压缩包",rar:"压缩包","7z":"压缩包"}[t]||t.toUpperCase()};return ge(()=>{m(),U.value==="course"&&(V(),w())}),(e,t)=>{const f=he;return r(),k("div",Te,[d("div",Ue,[t[7]||(t[7]=d("h2",null,"文件管理",-1)),d("div",Be,[o(l(me),{action:X,"auto-upload":!0,"before-upload":te,headers:Z.value,limit:1,"on-error":ae,"on-success":ee,class:"upload-button"},{default:s(()=>[o(l(F),{type:"primary"},{default:s(()=>[o(l(D),null,{default:s(()=>[o(l(ve))]),_:1}),t[6]||(t[6]=p(" 上传文件 "))]),_:1})]),_:1},8,["headers"])])]),o(l(be),{modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=a=>U.value=a),onTabClick:ue},{default:s(()=>[o(l(K),{label:"我的文件",name:"personal"},{default:s(()=>[d("div",Me,[G((r(),i(l(H),{data:_.value,style:{width:"100%"}},{default:s(()=>[o(l(u),{label:"文件名","min-width":"200"},{default:s(a=>[d("div",Pe,[o(l(D),{class:"file-icon"},{default:s(()=>[N(a.row.filename)?(r(),i(l(W),{key:0})):A(a.row.filename)?(r(),i(l(Y),{key:1})):(r(),i(l(q),{key:2}))]),_:2},1024),d("span",null,g(a.row.filename),1)])]),_:1}),o(l(u),{label:"大小",prop:"fileSize",width:"120"},{default:s(a=>[p(g(j(a.row.fileSize)),1)]),_:1}),o(l(u),{label:"类型",prop:"fileType",width:"120"},{default:s(a=>[p(g(de(a.row.filename)),1)]),_:1}),o(l(u),{label:"上传时间",prop:"uploadTime",width:"180"},{default:s(a=>[p(g(R(a.row.uploadTime)),1)]),_:1}),o(l(u),{fixed:"right",label:"操作",width:"200"},{default:s(a=>[o(l(F),{loading:b.value===a.row.id,size:"small",type:"primary",onClick:O=>I(a.row)},{default:s(()=>t[8]||(t[8]=[p(" 下载 ")])),_:2},1032,["loading","onClick"]),o(l(F),{loading:T.value===a.row.id,size:"small",type:"danger",onClick:O=>le(a.row)},{default:s(()=>t[9]||(t[9]=[p(" 删除 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[f,y.value]]),E.value>0?(r(),k("div",$e,[o(l(J),{"current-page":h.value,"onUpdate:currentPage":t[0]||(t[0]=a=>h.value=a),"page-size":C.value,"onUpdate:pageSize":t[1]||(t[1]=a=>C.value=a),"page-sizes":[10,20,50,100],total:E.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:se},null,8,["current-page","page-size","total"])])):L("",!0),_.value.length===0&&!y.value?(r(),i(l(Q),{key:1,description:"暂无文件"})):L("",!0)])]),_:1}),o(l(K),{label:"课程资料",name:"course"},{default:s(()=>[d("div",De,[d("div",Ve,[o(l(we),{modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=a=>P.value=a),clearable:"",placeholder:"选择课程",style:{width:"220px"},loading:$.value,filterable:"",onChange:ie},{default:s(()=>[(r(!0),k(ye,null,_e(M.value,a=>(r(),i(l(Ce),{key:a.id,label:a.courseName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),G((r(),i(l(H),{data:x.value,style:{width:"100%"}},{default:s(()=>[o(l(u),{label:"文件名","min-width":"200"},{default:s(a=>[d("div",Ie,[o(l(D),{class:"file-icon"},{default:s(()=>[N(a.row.filename)?(r(),i(l(W),{key:0})):A(a.row.filename)?(r(),i(l(Y),{key:1})):(r(),i(l(q),{key:2}))]),_:2},1024),d("span",null,g(a.row.filename),1)])]),_:1}),o(l(u),{label:"所属课程",prop:"courseName",width:"180"}),o(l(u),{label:"上传人",prop:"uploadUser",width:"120"}),o(l(u),{label:"大小",prop:"fileSize",width:"120"},{default:s(a=>[p(g(j(a.row.fileSize)),1)]),_:1}),o(l(u),{label:"上传时间",prop:"uploadTime",width:"180"},{default:s(a=>[p(g(R(a.row.uploadTime)),1)]),_:1}),o(l(u),{fixed:"right",label:"操作",width:"120"},{default:s(a=>[o(l(F),{loading:b.value===a.row.id,size:"small",type:"primary",onClick:O=>I(a.row)},{default:s(()=>t[10]||(t[10]=[p(" 下载 ")])),_:2},1032,["loading","onClick"])]),_:1})]),_:1},8,["data"])),[[f,z.value]]),B.value>0?(r(),k("div",je,[o(l(J),{"current-page":v.value,"onUpdate:currentPage":t[3]||(t[3]=a=>v.value=a),"page-size":S.value,"onUpdate:pageSize":t[4]||(t[4]=a=>S.value=a),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:re},null,8,["current-page","page-size","total"])])):L("",!0),x.value.length===0&&!z.value?(r(),i(l(Q),{key:1,description:"暂无课程资料"})):L("",!0)])]),_:1})]),_:1},8,["modelValue"])])}}}),Je=ce(Ne,[["__scopeId","data-v-62867261"]]);export{Je as default};
