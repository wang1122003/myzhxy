import{_ as se,r as u,a as re,o as ue,d as ie,e as E,f as t,w as a,y as de,z as A,A as z,i as pe,j as ce,k as me,T as fe,U as ve,x as ge,m as I,V as _e,v as r,B as ye,C as be,F as w,D as Ee,G as we,H as Ce,a2 as Ve,h as k,aQ as Te,g as De,aC as Se,aD as Ne,N as Ae,P as d,af as h}from"./index-DrN7HJWs.js";/* empty css                   *//* empty css                       *//* empty css                 *//* empty css                        */import{b as Ie,a as ke,u as Re,d as Be,c as Ue,e as Le}from"./notice-CrHf94I4.js";import{b as xe}from"./formatters-COdykrJD.js";import{R as ze,N as he}from"./NoticeDetailDialog-BQOCStDn.js";import"./request-BGbcGZqw.js";const Me={class:"notice-management-container"},Fe={class:"header"},Pe={class:"dialog-footer"},He=Object.assign({name:"AdminNoticeManagement"},{__name:"Notice",setup(Ye){const C=u(!1),R=u([]),V=u(0),_=u(1),b=u(10),i=re({title:"",status:"",type:""}),v=u(!1),T=u(!1),g=u(!1),D=u(!1),n=u({id:null,title:"",content:"",type:"SYSTEM",status:"PUBLISHED"}),B=u(null),y=u(null),M={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},m=async()=>{C.value=!0;try{const o={page:_.value,size:b.value,title:i.title||null,status:i.status||null,type:i.type||null},e=await Ie(o);R.value=e.data.records||[],V.value=e.data.total||0}catch(o){console.error("获取公告列表失败:",o),d.error("获取公告列表失败")}finally{C.value=!1}},F=o=>{n.value&&(n.value.content=o)},P=()=>{var o;g.value=!1,n.value={id:null,title:"",content:"",type:"SYSTEM",status:"PUBLISHED"},v.value=!0,(o=y.value)==null||o.resetFields()},H=async o=>{g.value=!0,resetForm();try{const e=await ke(o.id);e.code===200&&e.data?(n.value={...e.data},v.value=!0):d.error(e.message||"获取公告详情失败")}catch(e){console.error("获取公告详情失败",e),d.error("获取公告详情失败")}},Y=o=>{B.value=o.id,T.value=!0},O=async o=>{await h.confirm("确定要撤回该公告吗？撤回后将变为草稿状态。 ","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await Re(o.id,"DRAFT"),d.success("公告撤回成功"),m()}catch(e){console.error("撤回公告失败:",e),d.error("撤回公告失败")}},$=async o=>{await h.confirm("确定要删除该公告吗？此操作不可恢复。 ","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await Be(o.id),d.success("公告删除成功"),m()}catch(e){console.error("删除公告失败:",e),d.error("删除公告失败")}},q=()=>{var o;(o=y.value)==null||o.clearValidate()},j=async()=>{y.value&&await y.value.validate(async o=>{if(o){D.value=!0;try{g.value?(await Ue(n.value.id,n.value),d.success("公告更新成功")):(await Le(n.value),d.success("公告发布成功")),v.value=!1,m()}catch(e){console.error("提交公告失败:",e),d.error(g.value?"更新公告失败":"发布公告失败")}finally{D.value=!1}}})},G=o=>{b.value=o,_.value=1,m()},Q=o=>{_.value=o,m()},J=o=>({SYSTEM:"系统通知",ACADEMIC:"教学通知",ACTIVITY:"活动通知",OTHER:"其他通知"})[o]||"未知类型",K=o=>({PUBLISHED:"已发布",DRAFT:"草稿",RECALLED:"已撤回"})[o]||"未知状态",W=o=>{switch(o){case"PUBLISHED":return"success";case"DRAFT":return"info";case"RECALLED":return"warning";default:return""}};return ue(()=>{m()}),(o,e)=>{const p=ge,U=me,c=ce,s=ve,S=fe,L=pe,f=be,X=Ee,Z=we,ee=ye,te=Ve,le=De,x=Ne,ae=Se,oe=Ae,ne=Ce;return E(),ie("div",Me,[t(le,{class:"page-container"},{header:a(()=>[k("div",Fe,[e[13]||(e[13]=k("span",null,"公告管理",-1)),t(p,{icon:I(Te),type:"primary",onClick:P},{default:a(()=>e[12]||(e[12]=[r("发布公告")])),_:1},8,["icon"])])]),default:a(()=>[t(L,{inline:!0,model:i,class:"filter-form"},{default:a(()=>[t(c,{label:"标题"},{default:a(()=>[t(U,{modelValue:i.title,"onUpdate:modelValue":e[0]||(e[0]=l=>i.title=l),clearable:"",placeholder:"请输入公告标题关键词"},null,8,["modelValue"])]),_:1}),t(c,{label:"状态"},{default:a(()=>[t(S,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=l=>i.status=l),clearable:"",placeholder:"请选择状态"},{default:a(()=>[t(s,{label:"全部",value:""}),t(s,{label:"已发布",value:"PUBLISHED"}),t(s,{label:"草稿",value:"DRAFT"}),t(s,{label:"已撤回",value:"RECALLED"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"类型"},{default:a(()=>[t(S,{modelValue:i.type,"onUpdate:modelValue":e[2]||(e[2]=l=>i.type=l),clearable:"",placeholder:"请选择类型"},{default:a(()=>[t(s,{label:"全部",value:""}),t(s,{label:"系统通知",value:"SYSTEM"}),t(s,{label:"教学通知",value:"ACADEMIC"}),t(s,{label:"活动通知",value:"ACTIVITY"}),t(s,{label:"其他通知",value:"OTHER"})]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(p,{icon:I(_e),type:"primary",onClick:m},{default:a(()=>e[14]||(e[14]=[r("查询")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),de((E(),A(ee,{data:R.value,style:{width:"100%"}},{empty:a(()=>[t(Z,{description:"暂无公告数据"})]),default:a(()=>[t(f,{label:"标题","min-width":"200",prop:"title","show-overflow-tooltip":""}),t(f,{label:"类型",prop:"type",width:"120"},{default:a(l=>[r(w(J(l.row.type)),1)]),_:1}),t(f,{label:"状态",prop:"status",width:"100"},{default:a(l=>[t(X,{type:W(l.row.status)},{default:a(()=>[r(w(K(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(f,{label:"发布者",prop:"publisherName",width:"120"}),t(f,{label:"发布时间",prop:"publishTime",width:"160"},{default:a(l=>[r(w(I(xe)(l.row.publishTime)),1)]),_:1}),t(f,{label:"阅读量",prop:"readCount",width:"80"}),t(f,{fixed:"right",label:"操作",width:"220"},{default:a(l=>[t(p,{size:"small",type:"primary",onClick:N=>Y(l.row)},{default:a(()=>e[15]||(e[15]=[r("查看")])),_:2},1032,["onClick"]),t(p,{disabled:l.row.status==="RECALLED",size:"small",onClick:N=>H(l.row)},{default:a(()=>e[16]||(e[16]=[r(" 编辑 ")])),_:2},1032,["disabled","onClick"]),l.row.status==="PUBLISHED"?(E(),A(p,{key:0,size:"small",type:"warning",onClick:N=>O(l.row)},{default:a(()=>e[17]||(e[17]=[r(" 撤回 ")])),_:2},1032,["onClick"])):z("",!0),t(p,{size:"small",type:"danger",onClick:N=>$(l.row)},{default:a(()=>e[18]||(e[18]=[r("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,C.value]]),V.value>0?(E(),A(te,{key:0,"current-page":_.value,"onUpdate:currentPage":e[3]||(e[3]=l=>_.value=l),"page-size":b.value,"onUpdate:pageSize":e[4]||(e[4]=l=>b.value=l),"page-sizes":[10,20,50],total:V.value,class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:Q},null,8,["current-page","page-size","total"])):z("",!0)]),_:1}),t(oe,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l),title:g.value?"编辑公告":"发布公告","close-on-click-modal":!1,width:"70%",top:"5vh",onClose:q},{footer:a(()=>[k("span",Pe,[t(p,{onClick:e[9]||(e[9]=l=>v.value=!1)},{default:a(()=>e[21]||(e[21]=[r("取消")])),_:1}),t(p,{loading:D.value,type:"primary",onClick:j},{default:a(()=>[r(w(g.value?"保存":"发布"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(L,{ref_key:"noticeFormRef",ref:y,model:n.value,rules:M,"label-width":"100px"},{default:a(()=>[t(c,{label:"公告标题",prop:"title"},{default:a(()=>[t(U,{modelValue:n.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.title=l),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(c,{label:"公告类型",prop:"type"},{default:a(()=>[t(S,{modelValue:n.value.type,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.type=l),placeholder:"请选择公告类型",style:{width:"100%"}},{default:a(()=>[t(s,{label:"系统通知",value:"SYSTEM"}),t(s,{label:"教学通知",value:"ACADEMIC"}),t(s,{label:"活动通知",value:"ACTIVITY"}),t(s,{label:"其他通知",value:"OTHER"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"公告内容",prop:"content"},{default:a(()=>[t(ze,{modelValue:n.value.content,"onUpdate:modelValue":[e[7]||(e[7]=l=>n.value.content=l),F]},null,8,["modelValue"])]),_:1}),t(c,{label:"状态",prop:"status"},{default:a(()=>[t(ae,{modelValue:n.value.status,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.status=l)},{default:a(()=>[t(x,{label:"PUBLISHED"},{default:a(()=>e[19]||(e[19]=[r("直接发布")])),_:1}),t(x,{label:"DRAFT"},{default:a(()=>e[20]||(e[20]=[r("存为草稿")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(he,{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=l=>T.value=l),"notice-id":B.value},null,8,["modelValue","notice-id"])])}}}),Xe=se(He,[["__scopeId","data-v-6aa458b3"]]);export{Xe as default};
