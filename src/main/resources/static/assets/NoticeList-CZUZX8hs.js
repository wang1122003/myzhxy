import{_ as J,u as K,r as i,a as V,c as O,o as R,d as u,e as c,f as n,w as l,h as r,m as o,aT as q,y as P,A as _,z as M,B as Q,C as m,D as W,v as d,F as p,x as H,H as X,a2 as Y,G as Z,g as ee,J as S,K as te,L as ae,M as oe,N as ne,P as C}from"./index-DrN7HJWs.js";import{b as le,a as se}from"./notice-CrHf94I4.js";import{g as ie}from"./common-CBiGEV7V.js";import{d as re}from"./file-DSgdrnhe.js";import"./request-BGbcGZqw.js";const ce={class:"notice-list-container"},ue={key:0,class:"pagination-container"},de={key:0},pe={class:"notice-content"},ve={class:"notice-info"},ge=["innerHTML"],me={key:0,class:"notice-attachments"},fe={class:"dialog-footer"},he={__name:"NoticeList",setup(ye){const $=K(),f=i(!1),N=i(!1),b=i(!1),h=V({}),T=i([]),k=i(0),v=i(1),y=i(10),z=i([]),s=V({id:null,title:"",publisher:"",publishTime:"",content:"",attachments:[]}),g=i(!1),E=async()=>{f.value=!0;try{const t={page:v.value,size:y.value},e=await le(t);T.value=e.data.list||[],k.value=e.data.total||0}catch(t){console.error("获取通知列表失败",t),C.error("获取通知列表失败")}finally{f.value=!1}},A=async()=>{N.value=!0;try{const t=await ie();z.value=t.data||[]}catch(t){console.error("获取通知类型失败",t)}finally{N.value=!1}},x=O(()=>{const t={};return z.value.forEach(e=>{t[e.typeCode]={name:e.typeName,tag:e.tagType||"info"}}),t}),F=async t=>{b.value=!0,g.value=!0,s.id=null;try{const e=await se(t.id);Object.assign(s,e.data)}catch(e){console.error("获取通知详情失败",e),C.error("获取通知详情失败"),g.value=!1}finally{b.value=!1}},U=async t=>{if(!t||!t.id){C.warning("无效的文件信息");return}h[t.id]=!0;try{await re(t.id)}catch(e){console.error("下载附件失败",e),C.error(`下载附件 ${t.name} 失败`)}finally{h[t.id]=!1}},L=t=>{if(!t)return"";try{return new Date(t).toLocaleString("zh-CN",{hour12:!1})}catch{return t}},j=t=>{y.value=t,v.value=1,E()},I=t=>{v.value=t,E()},G=()=>{$.push("/")};return R(async()=>{await Promise.all([E(),A()])}),(t,e)=>{const B=X;return c(),u("div",ce,[n(o(q),{title:"返回首页",onBack:G},{content:l(()=>e[4]||(e[4]=[r("span",{class:"text-large font-600 mr-3"},"通知公告",-1)])),_:1}),n(o(ee),{class:"notice-list-card"},{default:l(()=>[P((c(),M(o(Q),{data:T.value,height:"calc(100vh - 260px)",style:{width:"100%"}},{default:l(()=>[n(o(m),{label:"标题","min-width":"300",prop:"title","show-overflow-tooltip":""}),n(o(m),{label:"类型",prop:"type",width:"120"},{default:l(a=>{var w;return[n(o(W),{type:((w=x.value[a.row.type])==null?void 0:w.tag)||"info"},{default:l(()=>{var D;return[d(p(((D=x.value[a.row.type])==null?void 0:D.name)||"其他"),1)]}),_:2},1032,["type"])]}),_:1}),n(o(m),{label:"发布时间",prop:"publishTime",width:"180"},{default:l(a=>[d(p(L(a.row.publishTime)),1)]),_:1}),n(o(m),{label:"已读",prop:"readCount",width:"80",align:"center"},{default:l(a=>[d(p(a.row.readCount??0),1)]),_:1}),n(o(m),{label:"操作",width:"100"},{default:l(a=>[n(o(H),{link:"",type:"primary",onClick:w=>F(a.row)},{default:l(()=>e[5]||(e[5]=[d(" 查看 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,f.value||N.value]]),k.value>0?(c(),u("div",ue,[n(o(Y),{"current-page":v.value,"onUpdate:currentPage":e[0]||(e[0]=a=>v.value=a),"page-size":y.value,"onUpdate:pageSize":e[1]||(e[1]=a=>y.value=a),"page-sizes":[10,20,50,100],total:k.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:I},null,8,["current-page","page-size","total"])])):_("",!0),T.value.length===0&&!f.value?(c(),M(o(Z),{key:1,description:"暂无通知公告"})):_("",!0)]),_:1}),n(o(ne),{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),title:s.title,"append-to-body":"",top:"5vh",width:"60%"},{footer:l(()=>[r("span",fe,[n(o(H),{onClick:e[2]||(e[2]=a=>g.value=!1)},{default:l(()=>e[7]||(e[7]=[d("关 闭")])),_:1})])]),default:l(()=>[s.id?P((c(),u("div",de,[r("div",pe,[r("div",ve,[r("span",null,"发布人："+p(s.publisher),1),r("span",null,"发布时间："+p(L(s.publishTime)),1)]),n(o(S)),r("div",{class:"notice-text",innerHTML:s.content},null,8,ge),s.attachments&&s.attachments.length?(c(),u("div",me,[n(o(S)),e[6]||(e[6]=r("h4",null,"附件：",-1)),r("ul",null,[(c(!0),u(te,null,ae(s.attachments,a=>(c(),u("li",{key:a.id},[n(o(oe),{disabled:h[a.id],loading:h[a.id],type:"primary",onClick:w=>U(a)},{default:l(()=>[d(p(a.name),1)]),_:2},1032,["disabled","loading","onClick"])]))),128))])])):_("",!0)])])),[[B,b.value]]):_("",!0)]),_:1},8,["modelValue","title"])])}}},Te=J(he,[["__scopeId","data-v-0691204d"]]);export{Te as default};
