import{_ as ee,r as c,a as A,o as te,d,e as i,h as n,f as l,w as o,K as V,L as I,U as ae,T as le,l as oe,m as L,V as ne,k as se,y as ie,A as f,z as S,B as re,C as ce,D as de,v as m,F as u,x as ue,aP as pe,H as me,a2 as _e,g as ge,J as fe,ai as ve,N as ye,P as b}from"./index-gQMZQ2sp.js";/* empty css                   *//* empty css                   *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        */import{b as we,c as he}from"./notice-BMWBVm9P.js";import{d as be}from"./file-Ck7nKFvu.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const Ee={class:"notices-container"},Ce={class:"page-header"},Ne={class:"filter-container"},ke={class:"notice-title"},Te={key:0,class:"pagination-container"},Ve={class:"notice-meta"},Se=["innerHTML"],Ue={key:0,class:"notice-attachments"},De={class:"dialog-footer"},Me={__name:"Notices",setup(Oe){const B=[{label:"全部",value:""},{label:"公告",value:"ANNOUNCEMENT"},{label:"课程",value:"COURSE"},{label:"考试",value:"EXAM"},{label:"活动",value:"ACTIVITY"},{label:"其他",value:"OTHER"}],U=c([]),E=c(!1),C=c(0),_=c(1),v=c(10),p=A({type:"",keyword:""}),y=c(!1),s=A({}),N=c(null),w=async()=>{E.value=!0;try{const t=await we({page:_.value,size:v.value,type:p.type,keyword:p.keyword});U.value=t.data.list||[],C.value=t.data.total||0}catch(t){console.error("获取公告列表失败",t),b.error("获取公告列表失败")}finally{E.value=!1}},$=async t=>{try{const e=await he(t);Object.assign(s,e.data)}catch(e){console.error("获取公告详情失败",e),b.error("获取公告详情失败")}},H=t=>({ANNOUNCEMENT:"",COURSE:"success",EXAM:"danger",ACTIVITY:"warning",OTHER:"info"})[t]||"info",D=t=>({ANNOUNCEMENT:"公告",COURSE:"课程",EXAM:"考试",ACTIVITY:"活动",OTHER:"其他"})[t]||"通知",j=t=>{if(!t)return!1;const e=new Date,g=new Date(t),r=Math.abs(e-g);return Math.ceil(r/(1e3*60*60*24))<=3},M=t=>{if(!t)return"-";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},O=()=>{_.value=1,w()},F=t=>{v.value=t,w()},P=t=>{_.value=t,w()},Y=t=>{z(t)},z=async t=>{y.value=!0,Object.assign(s,t),await $(t.id)},X=async t=>{N.value=t.id;try{const e=await be(t.id),g=new Blob([e.data]),r=document.createElement("a");r.href=URL.createObjectURL(g),r.download=t.filename,r.click(),URL.revokeObjectURL(r.href),b.success("文件下载成功")}catch(e){console.error("文件下载失败",e),b.error("文件下载失败")}finally{N.value=null}};return te(()=>{w()}),(t,e)=>{const g=ae,r=le,k=oe,J=se,x=de,h=ce,T=ue,K=re,q=_e,G=ge,Q=fe,W=ye,Z=me;return i(),d("div",Ee,[n("div",Ce,[e[6]||(e[6]=n("h2",null,"校园公告",-1)),n("div",Ne,[l(r,{modelValue:p.type,"onUpdate:modelValue":e[0]||(e[0]=a=>p.type=a),clearable:"",placeholder:"公告类型",style:{width:"120px","margin-right":"15px"},onChange:O},{default:o(()=>[(i(),d(V,null,I(B,a=>l(g,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(J,{modelValue:p.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>p.keyword=a),clearable:"",placeholder:"搜索公告标题",style:{width:"220px"},onInput:O},{prefix:o(()=>[l(k,null,{default:o(()=>[l(L(ne))]),_:1})]),_:1},8,["modelValue"])])]),l(G,{class:"notice-list-card",shadow:"hover"},{default:o(()=>[ie((i(),S(K,{data:U.value,style:{width:"100%"},onRowClick:Y},{default:o(()=>[l(h,{label:"标题","min-width":"300",prop:"title"},{default:o(a=>[n("div",ke,[a.row.type?(i(),S(x,{key:0,type:H(a.row.type),class:"notice-tag",size:"small"},{default:o(()=>[m(u(D(a.row.type)),1)]),_:2},1032,["type"])):f("",!0),n("span",null,u(a.row.title),1),j(a.row.publishTime)?(i(),S(x,{key:1,class:"new-tag",effect:"plain",size:"small",type:"danger"},{default:o(()=>e[7]||(e[7]=[m(" 新 ")])),_:1})):f("",!0)])]),_:1}),l(h,{label:"发布者",prop:"publisher",width:"150"}),l(h,{label:"发布时间",prop:"publishTime",width:"180"},{default:o(a=>[m(u(M(a.row.publishTime)),1)]),_:1}),l(h,{fixed:"right",label:"操作",width:"120"},{default:o(a=>[l(T,{size:"small",type:"primary",onClick:pe(R=>z(a.row),["stop"])},{default:o(()=>e[8]||(e[8]=[m(" 查看详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,E.value]]),C.value>0?(i(),d("div",Te,[l(q,{"current-page":_.value,"onUpdate:currentPage":e[2]||(e[2]=a=>_.value=a),"page-size":v.value,"onUpdate:pageSize":e[3]||(e[3]=a=>v.value=a),layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50],total:C.value,onSizeChange:F,onCurrentChange:P},null,8,["current-page","page-size","total"])])):f("",!0)]),_:1}),l(W,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=a=>y.value=a),title:s.title,"destroy-on-close":"",top:"5vh",width:"60%"},{footer:o(()=>[n("span",De,[l(T,{onClick:e[4]||(e[4]=a=>y.value=!1)},{default:o(()=>e[10]||(e[10]=[m("关闭")])),_:1})])]),default:o(()=>[s.id?(i(),d(V,{key:0},[n("div",Ve,[n("span",null,"发布人: "+u(s.publisher),1),n("span",null,"发布时间: "+u(M(s.publishTime)),1),n("span",null,"类型: "+u(D(s.type)),1)]),l(Q),n("div",{class:"notice-content",innerHTML:s.content},null,8,Se),s.attachments&&s.attachments.length>0?(i(),d("div",Ue,[e[9]||(e[9]=n("h4",null,"附件列表:",-1)),(i(!0),d(V,null,I(s.attachments,(a,R)=>(i(),d("div",{key:R,class:"attachment-item"},[l(T,{loading:N.value===a.id,link:"",type:"primary",onClick:ze=>X(a)},{default:o(()=>[l(k,null,{default:o(()=>[l(L(ve))]),_:1}),m(" "+u(a.filename),1)]),_:2},1032,["loading","onClick"])]))),128))])):f("",!0)],64)):f("",!0)]),_:1},8,["modelValue","title"])])}}},Je=ee(Me,[["__scopeId","data-v-2be7587e"]]);export{Je as default};
