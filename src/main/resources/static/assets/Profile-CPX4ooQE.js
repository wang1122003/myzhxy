import{_ as X,J as z,aD as B,aC as M,k as J,j as T,i as F,N as L,l as j,x as q,az as O,a4 as H,g as K,aB as Q,aA as W,ay as Y,R as Z,d as x,e as $,h as f,f as a,w as r,v as s,F as p,u as ee,r as g,o as ae,aF as R,P as i,aE as C,aG as S,an as w}from"./index-gQMZQ2sp.js";/* empty css                   *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                   *//* empty css                             *//* empty css                    */import{g as oe,u as le}from"./user-xlhqAG_R.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const re={name:"TeacherProfile",components:{Upload:Y,ElDescriptions:W,ElDescriptionsItem:Q,ElCard:K,ElAvatar:H,ElUpload:O,ElButton:q,ElIcon:j,ElDialog:L,ElForm:F,ElFormItem:T,ElInput:J,ElRadioGroup:M,ElRadio:B,ElDivider:z},setup(){const d=ee(),e=g(!1),V=g(null),o=g(!1),b=g({}),E=g(!1),v=g(!1),U=g("/api/upload/avatar"),I=g({Authorization:localStorage.getItem("Authorization-Token")||""}),y={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","change"]}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:["blur","change"]}]};ae(async()=>{E.value=!0;try{if(!R.value){i.error("无法获取用户ID，请重新登录"),await c();return}const l=await oe(R.value);l.code===200&&l.data?b.value={...l.data}:i.error(l.message||"获取用户信息失败")}catch(l){console.error("获取用户信息异常:",l),i.error("获取用户信息异常")}finally{E.value=!1}});const m=()=>{v.value=!0,C.value&&(b.value={...C.value})},h=()=>{V.value.validate(l=>{if(l){const u={...b.value};le(u).then(n=>{n.code===0||n.code===200?(i.success("更新成功"),e.value=!1,S(n.data||u)):i.error(n.message||"更新失败")}).catch(n=>{var G,N;console.error("更新教师信息失败",n);const t=((N=(G=n.response)==null?void 0:G.data)==null?void 0:N.message)||n.message||"更新教师信息失败";i.error(t)})}})},A=(l,u)=>{if(o.value=!1,l.code===0||l.code===200)if(l.data&&l.data.url){i.success("头像上传成功");const n={...C.value,avatarUrl:l.data.url};S(n)}else i.error(l.message||"头像上传成功但未返回URL");else i.error(l.message||"头像上传失败")},P=l=>{o.value=!1;let u="头像上传失败";try{u=JSON.parse(l.message||"{}").message||u}catch{}i.error(u),console.error("头像上传错误:",l)},_=l=>{const u=l.type==="image/jpeg",n=l.type==="image/png",t=l.size/1024/1024<2;return!u&&!n?(i.error("头像图片只能是 JPG 或 PNG 格式!"),!1):t?(o.value=!0,!0):(i.error("头像图片大小不能超过 2MB!"),!1)},c=async()=>{try{await w(),d.push("/login")}catch(l){console.error("登出时出错:",l),w(),d.push("/login")}};return{dialogVisible:e,formRef:V,form:b,rules:y,handleEdit:m,handleSubmit:h,uploadAvatarUrl:U,headers:I,handleAvatarSuccess:A,handleAvatarError:P,beforeAvatarUpload:_,uploadingAvatar:o,formatGender:l=>l===1?"男":l===0?"女":"未知"}}},te={class:"profile-container"},ne={class:"page-header"},se={class:"profile-info"},de={class:"avatar-container"},ie={class:"info-container"},ue={class:"profile-section"},me={class:"dialog-footer"};function fe(d,e,V,o,b,E){const v=q,U=H,I=Z("Upload"),y=j,D=O,m=Q,h=W,A=z,P=K,_=J,c=T,k=B,l=M,u=F,n=L;return $(),x("div",te,[f("div",ne,[e[9]||(e[9]=f("h2",null,"个人信息",-1)),a(v,{type:"primary",onClick:o.handleEdit},{default:r(()=>e[8]||(e[8]=[s(" 编辑信息 ")])),_:1},8,["onClick"])]),a(P,{class:"profile-card"},{default:r(()=>[f("div",se,[f("div",de,[a(U,{size:100,src:d.userAvatar},{default:r(()=>{var t;return[s(p((t=d.userInfo.name)==null?void 0:t.substring(0,1)),1)]}),_:1},8,["src"]),a(D,{action:o.uploadAvatarUrl,disabled:o.uploadingAvatar,"before-upload":o.beforeAvatarUpload,"on-success":o.handleAvatarSuccess,headers:o.headers,"show-file-list":!1,class:"avatar-uploader","on-error":o.handleAvatarError},{default:r(()=>[a(v,{loading:o.uploadingAvatar,size:"small",type:"primary"},{default:r(()=>[a(y,null,{default:r(()=>[a(I)]),_:1}),e[10]||(e[10]=s(" 更换头像 "))]),_:1},8,["loading"])]),_:1},8,["action","disabled","before-upload","on-success","headers","on-error"])]),f("div",ie,[a(h,{column:2,border:"",title:"基本信息"},{default:r(()=>[a(m,{label:"工号"},{default:r(()=>[s(p(d.userInfo.username),1)]),_:1}),a(m,{label:"姓名"},{default:r(()=>[s(p(d.userInfo.name),1)]),_:1}),a(m,{label:"性别"},{default:r(()=>[s(p(o.formatGender(d.userInfo.gender)),1)]),_:1}),a(m,{label:"院系"},{default:r(()=>[s(p(d.userInfo.department),1)]),_:1}),a(m,{label:"职称"},{default:r(()=>[s(p(d.userInfo.title||"-"),1)]),_:1}),a(m,{label:"邮箱"},{default:r(()=>[s(p(d.userInfo.email),1)]),_:1}),a(m,{label:"手机"},{default:r(()=>[s(p(d.userInfo.phone),1)]),_:1})]),_:1}),a(A),f("div",ue,[e[11]||(e[11]=f("h3",null,"个人简介",-1)),f("p",null,p(d.userInfo.bio||"暂无个人简介"),1)])])])]),_:1}),a(n,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[7]||(e[7]=t=>o.dialogVisible=t),title:"编辑个人信息",width:"500px"},{footer:r(()=>[f("span",me,[a(v,{onClick:e[6]||(e[6]=t=>o.dialogVisible=!1)},{default:r(()=>e[14]||(e[14]=[s("取消")])),_:1}),a(v,{type:"primary",onClick:o.handleSubmit},{default:r(()=>e[15]||(e[15]=[s("保存")])),_:1},8,["onClick"])])]),default:r(()=>[a(u,{ref:"formRef",model:o.form,rules:o.rules,"label-width":"100px"},{default:r(()=>[a(c,{label:"姓名",prop:"name"},{default:r(()=>[a(_,{modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=t=>o.form.name=t),disabled:!0},null,8,["modelValue"])]),_:1}),a(c,{label:"性别",prop:"gender"},{default:r(()=>[a(l,{modelValue:o.form.gender,"onUpdate:modelValue":e[1]||(e[1]=t=>o.form.gender=t)},{default:r(()=>[a(k,{value:"male"},{default:r(()=>e[12]||(e[12]=[s(" 男 ")])),_:1}),a(k,{value:"female"},{default:r(()=>e[13]||(e[13]=[s(" 女 ")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"院系",prop:"department"},{default:r(()=>[a(_,{modelValue:o.form.department,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.department=t),disabled:!0},null,8,["modelValue"])]),_:1}),a(c,{label:"职称",prop:"title"},{default:r(()=>[a(_,{modelValue:o.form.title,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.title=t)},null,8,["modelValue"])]),_:1}),a(c,{label:"邮箱",prop:"email"},{default:r(()=>[a(_,{modelValue:o.form.email,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.email=t)},null,8,["modelValue"])]),_:1}),a(c,{label:"手机",prop:"phone"},{default:r(()=>[a(_,{modelValue:o.form.phone,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.phone=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const he=X(re,[["render",fe],["__scopeId","data-v-6aa868c7"]]);export{he as default};
