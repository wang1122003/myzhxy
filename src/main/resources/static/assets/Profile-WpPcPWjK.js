import{_ as B,P as n,ay as N,R as F,d as R,e as q,h as u,f as o,w as l,v as t,x as M,a4 as T,F as c,az as j,l as G,aA as J,aB as L,g as O,i as H,j as K,k as Q,N as W,r as i,a as X,aE as y,aF as V,aG as Y,u as Z,o as x,an as A}from"./index-gQMZQ2sp.js";/* empty css                   *//* empty css                 *//* empty css                             *//* empty css                    */import{u as $,g as ee}from"./user-xlhqAG_R.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const I=Z(),g=i({}),_=i(!1),U=i(!1);i("/api/upload/avatar");i({Authorization:localStorage.getItem("Authorization-Token")||""});const ae=async()=>{_.value=!0;try{if(!V.value){n.error("无法获取用户ID，请重新登录"),await re();return}const e=await ee(V.value);e.code===200&&e.data?g.value={...e.data}:n.error(e.message||"获取用户信息失败")}catch(e){console.error("获取用户信息异常:",e),n.error("获取用户信息异常")}finally{_.value=!1}};x(ae);const oe=()=>{U.value=!0,y.value&&(g.value={...y.value})},le=async()=>{_.value=!0;try{g.value.id||(g.value.id=V.value);const e=await $(g.value);e.code===200?(n.success("个人信息更新成功"),Y(e.data),U.value=!1):n.error(e.message||"更新失败")}catch(e){console.error("更新用户信息异常:",e),n.error("更新用户信息异常")}finally{_.value=!1}},re=async()=>{try{await A(),I.push("/login")}catch(e){console.error("登出时出错:",e),A(),I.push("/login")}},se={name:"AdminProfile",components:{Upload:N,ElMessage:n},setup(){const e=i(!1),a=i(null),v=i(!1),r=X({id:"",name:"",email:"",phone:"",avatar:""});return{dialogVisible:e,formRef:a,form:r,rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","change"]}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:["blur","change"]}]},handleEdit:oe,handleSubmit:()=>{a.value.validate(d=>{d&&({...r},le().then(()=>{e.value=!1}))})},handleAvatarError:d=>{v.value=!1;let f="头像上传失败";try{f=JSON.parse(d.message||"{}").message||f}catch{}n.error(f),console.error("头像上传错误:",d)},uploadingAvatar:v}}},te={class:"profile-container"},ne={class:"page-header"},ie={class:"profile-info"},de={class:"avatar-container"},ue={class:"info-container"},me={class:"dialog-footer"};function fe(e,a,v,r,k,w){const m=M,d=T,f=F("Upload"),b=G,C=j,p=L,S=J,D=O,h=Q,E=K,P=H,z=W;return q(),R("div",te,[u("div",ne,[a[6]||(a[6]=u("h2",null,"个人信息",-1)),o(m,{type:"primary",onClick:r.handleEdit},{default:l(()=>a[5]||(a[5]=[t(" 编辑信息 ")])),_:1},8,["onClick"])]),o(D,{class:"profile-card"},{default:l(()=>[u("div",ie,[u("div",de,[o(d,{size:100,src:e.userAvatar},{default:l(()=>{var s;return[t(c((s=e.userInfo.name)==null?void 0:s.substring(0,1)),1)]}),_:1},8,["src"]),o(C,{action:e.uploadAvatarUrl,"before-upload":e.beforeAvatarUpload,disabled:r.uploadingAvatar,headers:e.headers,"on-error":r.handleAvatarError,"on-success":e.handleAvatarSuccess,"show-file-list":!1,class:"avatar-uploader"},{default:l(()=>[o(m,{loading:r.uploadingAvatar,size:"small",type:"primary"},{default:l(()=>[o(b,null,{default:l(()=>[o(f)]),_:1}),a[7]||(a[7]=t(" 更换头像 "))]),_:1},8,["loading"])]),_:1},8,["action","before-upload","disabled","headers","on-error","on-success"])]),u("div",ue,[o(S,{column:2,border:"",title:"基本信息"},{default:l(()=>[o(p,{label:"用户名"},{default:l(()=>[t(c(e.userInfo.username),1)]),_:1}),o(p,{label:"姓名"},{default:l(()=>[t(c(e.userInfo.name),1)]),_:1}),o(p,{label:"角色"},{default:l(()=>a[8]||(a[8]=[t(" 管理员 ")])),_:1}),o(p,{label:"邮箱"},{default:l(()=>[t(c(e.userInfo.email),1)]),_:1}),o(p,{label:"手机"},{default:l(()=>[t(c(e.userInfo.phone),1)]),_:1})]),_:1})])])]),_:1}),o(z,{modelValue:r.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=s=>r.dialogVisible=s),title:"编辑个人信息",width:"500px"},{footer:l(()=>[u("span",me,[o(m,{onClick:a[3]||(a[3]=s=>r.dialogVisible=!1)},{default:l(()=>a[9]||(a[9]=[t("取消")])),_:1}),o(m,{type:"primary",onClick:r.handleSubmit},{default:l(()=>a[10]||(a[10]=[t("保存")])),_:1},8,["onClick"])])]),default:l(()=>[o(P,{ref:"formRef",model:r.form,rules:r.rules,"label-width":"100px"},{default:l(()=>[o(E,{label:"姓名",prop:"name"},{default:l(()=>[o(h,{modelValue:r.form.name,"onUpdate:modelValue":a[0]||(a[0]=s=>r.form.name=s)},null,8,["modelValue"])]),_:1}),o(E,{label:"邮箱",prop:"email"},{default:l(()=>[o(h,{modelValue:r.form.email,"onUpdate:modelValue":a[1]||(a[1]=s=>r.form.email=s)},null,8,["modelValue"])]),_:1}),o(E,{label:"手机",prop:"phone"},{default:l(()=>[o(h,{modelValue:r.form.phone,"onUpdate:modelValue":a[2]||(a[2]=s=>r.form.phone=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Ve=B(se,[["render",fe],["__scopeId","data-v-89746fd2"]]);export{Ve as default};
