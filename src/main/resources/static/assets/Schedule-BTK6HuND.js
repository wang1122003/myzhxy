import{_ as O,d as m,e as n,h as f,y as P,f as t,w as s,K as F,L as R,z as x,U as j,T as H,aH as G,v,aC as K,H as q,F as i,a8 as J,A as M,aI as Q,B as X,C as Y,x as Z,g as $,aA as ee,aB as le,N as oe,r as d,c as ae,o as te,b as se,P as W}from"./index-gQMZQ2sp.js";/* empty css                   *//* empty css                   *//* empty css                             *//* empty css                        *//* empty css               *//* empty css                       *//* empty css                        *//* empty css                  */import{g as re}from"./schedule-_r-PKiUu.js";import{a as ne,b as ie,c as de}from"./common-CbP0GatP.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const ce={name:"StudentScheduleView",setup(){const p=d(!1),o=d(!1),y=d(!1),e=d(!1),w=d([]),D=d("week"),b=d(null),E=d(!1),k=d(null),g=d([]),_=d([]),h=d([]),T=d(!1),B=async()=>{o.value=!0,y.value=!0,e.value=!0;try{const[a,r,C]=await Promise.all([ne(),ie(),de()]);g.value=a.data,_.value=r.data,h.value=C.data,g.value.length>0&&(b.value=g.value[0].value,await V())}catch(a){console.error("获取初始数据失败",a),W.error("获取学期/时间段/星期数据失败")}finally{o.value=!1,y.value=!1,e.value=!1}},c={},S=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#3ECBBC","#EA7C69","#AA68CA","#68C0CA","#CA6897"],V=async()=>{if(b.value){p.value=!0;try{const a=await re({semester:b.value});w.value=a.data||[],Object.keys(c).forEach(r=>delete c[r]),w.value.forEach(r=>{if(r.courseId&&!c[r.courseId]){const C=Object.keys(c).length%S.length;c[r.courseId]=S[C]}})}catch(a){console.error("获取课表失败",a),W.error("获取课表失败"),w.value=[]}finally{p.value=!1}}},N=ae(()=>{const a={};return h.value.forEach(r=>{a[r.value]=r.label}),a}),l=a=>N.value[a]||"",u=a=>{if(!a||!a.includes(":"))return 0;const[r,C]=a.split(":").map(Number);return r*60+C},I=(a,r)=>{if(!r||!r.startTime||!r.endTime)return null;const C=u(r.startTime);return w.value.find(L=>L.weekday!==a?!1:u(L.startTime)===C)},z=a=>c[a]||"#409EFF",U=a=>{k.value=a,E.value=!0},A=()=>{T.value=window.innerWidth<768};return te(()=>{B(),A(),window.addEventListener("resize",A)}),se(()=>{window.removeEventListener("resize",A)}),{loadingSchedule:p,loadingSemesters:o,loadingTimeSlots:y,loadingWeekdays:e,scheduleList:w,viewType:D,semester:b,semestersRef:g,timeSlotsRef:_,weekdaysRef:h,dialogVisible:E,currentCourse:k,fetchSchedule:V,formatWeekday:l,findCourseForCell:I,getCourseColor:z,showCourseDetail:U,isMobile:T}}},ue={class:"schedule-container"},me={class:"page-header"},fe={class:"filter-container"},ve={key:0,class:"week-view-wrapper"},_e={class:"week-view"},Ce={class:"time-column"},we={class:"time-range"},be={class:"header-cell"},ge=["onClick"],he={class:"course-name"},ke={class:"course-location"},pe={key:1,class:"list-view"},ye={class:"dialog-footer"};function Ee(p,o,y,e,w,D){const b=j,E=H,k=G,g=K,_=Y,h=Z,T=X,B=$,c=le,S=ee,V=oe,N=q;return n(),m("div",ue,[f("div",me,[o[6]||(o[6]=f("h2",null,"我的课表",-1)),f("div",fe,[t(E,{modelValue:e.semester,"onUpdate:modelValue":o[0]||(o[0]=l=>e.semester=l),placeholder:"选择学期",style:{"margin-right":"10px"},loading:e.loadingSemesters,filterable:"",onChange:e.fetchSchedule},{default:s(()=>[(n(!0),m(F,null,R(e.semestersRef,l=>(n(),x(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","onChange"]),t(g,{modelValue:e.viewType,"onUpdate:modelValue":o[1]||(o[1]=l=>e.viewType=l),style:{"margin-left":"20px"}},{default:s(()=>[t(k,{label:"week"},{default:s(()=>o[4]||(o[4]=[v(" 周视图 ")])),_:1}),t(k,{label:"list"},{default:s(()=>o[5]||(o[5]=[v(" 列表视图 ")])),_:1})]),_:1},8,["modelValue"])])]),P((n(),x(B,{class:"schedule-card"},{default:s(()=>[e.viewType==="week"?(n(),m("div",ve,[f("div",_e,[f("div",Ce,[o[7]||(o[7]=f("div",{class:"header-cell"}," 时间 ",-1)),(n(!0),m(F,null,R(e.timeSlotsRef,l=>(n(),m("div",{key:l.slot,class:"time-cell"},[v(i(l.label)+" ",1),f("div",we,i(l.startTime)+" - "+i(l.endTime),1)]))),128))]),(n(!0),m(F,null,R(e.weekdaysRef,l=>(n(),m("div",{key:l.value,class:"day-column"},[f("div",be,i(l.label),1),(n(!0),m(F,null,R(e.timeSlotsRef,u=>(n(),m("div",{key:`${l.value}-${u.slot}`,class:J([{"has-course":e.findCourseForCell(l.value,u)},"schedule-cell"])},[e.findCourseForCell(l.value,u)?(n(),m("div",{key:0,style:Q({backgroundColor:e.getCourseColor(e.findCourseForCell(l.value,u).courseId)}),class:"course-item",onClick:I=>e.showCourseDetail(e.findCourseForCell(l.value,u))},[f("div",he,i(e.findCourseForCell(l.value,u).courseName),1),f("div",ke,i(e.findCourseForCell(l.value,u).classroom),1)],12,ge)):M("",!0)],2))),128))]))),128))])])):(n(),m("div",pe,[t(T,{data:e.scheduleList,border:"",style:{width:"100%"}},{default:s(()=>[t(_,{label:"课程名称",prop:"courseName","min-width":"120"}),e.isMobile?M("",!0):(n(),x(_,{key:0,label:"授课教师",prop:"teacherName","min-width":"100"})),t(_,{label:"星期",prop:"weekday",width:"80"},{default:s(l=>[v(i(e.formatWeekday(l.row.weekday)),1)]),_:1}),t(_,{label:"开始时间",prop:"startTime"}),t(_,{label:"结束时间",prop:"endTime"}),t(_,{label:"教室",prop:"classroom","min-width":"100"}),t(_,{label:"操作",fixed:"right",width:"80"},{default:s(l=>[t(h,{size:"small",type:"primary",onClick:u=>e.showCourseDetail(l.row)},{default:s(()=>o[8]||(o[8]=[v(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]))]),_:1})),[[N,e.loadingSchedule||e.loadingTimeSlots||e.loadingWeekdays]]),t(V,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[3]||(o[3]=l=>e.dialogVisible=l),title:"课程详情",width:"500px"},{footer:s(()=>[f("span",ye,[t(h,{onClick:o[2]||(o[2]=l=>e.dialogVisible=!1)},{default:s(()=>o[9]||(o[9]=[v("关闭")])),_:1})])]),default:s(()=>[e.currentCourse?(n(),x(S,{key:0,column:1,border:"",title:""},{default:s(()=>[t(c,{label:"课程名称"},{default:s(()=>[v(i(e.currentCourse.courseName),1)]),_:1}),t(c,{label:"授课教师"},{default:s(()=>[v(i(e.currentCourse.teacherName),1)]),_:1}),t(c,{label:"上课时间"},{default:s(()=>[v(i(e.formatWeekday(e.currentCourse.weekday))+" "+i(e.currentCourse.startTime)+" - "+i(e.currentCourse.endTime),1)]),_:1}),t(c,{label:"上课地点"},{default:s(()=>[v(i(e.currentCourse.classroom),1)]),_:1}),t(c,{label:"学分"},{default:s(()=>[v(i(e.currentCourse.credit),1)]),_:1})]),_:1})):M("",!0)]),_:1},8,["modelValue"])])}const ze=O(ce,[["render",Ee],["__scopeId","data-v-6351794b"]]);export{ze as default};
