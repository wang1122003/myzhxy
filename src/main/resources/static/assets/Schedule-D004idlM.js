import{_ as X,aB as L,aA as z,N as U,x as O,aH as P,aC as j,U as H,T as G,C as K,B as q,g as J,d,e as n,h as _,y as Y,f as s,w as t,K as S,L as F,z as A,v as u,H as Z,F as i,a8 as $,A as M,aI as ee,r as c,c as le,o as oe,P as W}from"./index-gQMZQ2sp.js";/* empty css                   *//* empty css                   *//* empty css                             *//* empty css                        *//* empty css               *//* empty css                       *//* empty css                        *//* empty css                  */import{a as ae}from"./schedule-_r-PKiUu.js";import{a as se,b as te,c as re}from"./common-CbP0GatP.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const ne={name:"TeacherScheduleView",components:{ElCard:J,ElTable:q,ElTableColumn:K,ElSelect:G,ElOption:H,ElRadioGroup:j,ElRadioButton:P,ElButton:O,ElDialog:U,ElDescriptions:z,ElDescriptionsItem:L},setup(){const w=c(!1),o=c(!1),T=c(!1),e=c(!1),p=c([]),B=c("week"),b=c(null),E=c(!1),h=c(null),k=c([]),m=c([]),y=c([]),R=async()=>{o.value=!0,T.value=!0,e.value=!0;try{const[a,r,g]=await Promise.all([se(),te(),re()]);k.value=a.data,m.value=r.data,y.value=g.data,k.value.length>0&&(b.value=k.value[0].value,await V())}catch(a){console.error("获取初始数据失败",a),W.error("获取学期/时间段/星期数据失败")}finally{o.value=!1,T.value=!1,e.value=!1}},v={},C=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#3ECBBC","#EA7C69","#AA68CA","#68C0CA","#CA6897"],V=async()=>{if(b.value){w.value=!0;try{const a=await ae({semester:b.value});p.value=a.data||[],Object.keys(v).forEach(r=>delete v[r]),p.value.forEach(r=>{if(r.courseId&&!v[r.courseId]){const g=Object.keys(v).length%C.length;v[r.courseId]=C[g]}})}catch(a){console.error("获取课表失败",a),W.error("获取课表失败"),p.value=[]}finally{w.value=!1}}},N=le(()=>{const a={};return y.value.forEach(r=>{a[r.value]=r.label}),a}),x=a=>N.value[a]||"",l=a=>{if(!a||!a.includes(":"))return 0;const[r,g]=a.split(":").map(Number);return r*60+g},f=(a,r)=>{if(!r||!r.startTime||!r.endTime)return null;const g=l(r.startTime);return p.value.find(I=>I.weekday!==a?!1:l(I.startTime)===g)},D=a=>v[a]||"#409EFF",Q=a=>{h.value=a,E.value=!0};return oe(()=>{R()}),{loadingSchedule:w,loadingSemesters:o,loadingTimeSlots:T,loadingWeekdays:e,scheduleList:p,viewType:B,semester:b,semestersRef:k,timeSlotsRef:m,weekdaysRef:y,dialogVisible:E,currentCourse:h,fetchSchedule:V,formatWeekday:x,findCourseForCell:f,getCourseColor:D,showCourseDetail:Q}}},ie={class:"schedule-container"},ce={class:"page-header"},de={class:"filter-container"},ue={key:0,class:"week-view"},me={class:"time-column"},fe={class:"time-range"},_e={class:"header-cell"},ve=["onClick"],Ce={class:"course-name"},ge={class:"course-location"},pe={key:1,class:"list-view"},be={class:"dialog-footer"};function ke(w,o,T,e,p,B){const b=H,E=G,h=P,k=j,m=K,y=O,R=q,v=J,C=L,V=z,N=U,x=Z;return n(),d("div",ie,[_("div",ce,[o[6]||(o[6]=_("h2",null,"我的课表",-1)),_("div",de,[s(E,{modelValue:e.semester,"onUpdate:modelValue":o[0]||(o[0]=l=>e.semester=l),placeholder:"选择学期",style:{"margin-right":"10px"},loading:e.loadingSemesters,filterable:"",onChange:e.fetchSchedule},{default:t(()=>[(n(!0),d(S,null,F(e.semestersRef,l=>(n(),A(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","onChange"]),s(k,{modelValue:e.viewType,"onUpdate:modelValue":o[1]||(o[1]=l=>e.viewType=l),style:{"margin-left":"20px"}},{default:t(()=>[s(h,{label:"week"},{default:t(()=>o[4]||(o[4]=[u(" 周视图 ")])),_:1}),s(h,{label:"list"},{default:t(()=>o[5]||(o[5]=[u(" 列表视图 ")])),_:1})]),_:1},8,["modelValue"])])]),Y((n(),A(v,{class:"schedule-card"},{default:t(()=>[e.viewType==="week"?(n(),d("div",ue,[_("div",me,[o[7]||(o[7]=_("div",{class:"header-cell"}," 时间 ",-1)),(n(!0),d(S,null,F(e.timeSlotsRef,l=>(n(),d("div",{key:l.slot,class:"time-cell"},[u(i(l.label)+" ",1),_("div",fe,i(l.startTime)+" - "+i(l.endTime),1)]))),128))]),(n(!0),d(S,null,F(e.weekdaysRef,l=>(n(),d("div",{key:l.value,class:"day-column"},[_("div",_e,i(l.label),1),(n(!0),d(S,null,F(e.timeSlotsRef,f=>(n(),d("div",{key:`${l.value}-${f.slot}`,class:$([{"has-course":e.findCourseForCell(l.value,f)},"schedule-cell"])},[e.findCourseForCell(l.value,f)?(n(),d("div",{key:0,style:ee({backgroundColor:e.getCourseColor(e.findCourseForCell(l.value,f).courseId)}),class:"course-item",onClick:D=>e.showCourseDetail(e.findCourseForCell(l.value,f))},[_("div",Ce,i(e.findCourseForCell(l.value,f).courseName),1),_("div",ge,i(e.findCourseForCell(l.value,f).classroom),1)],12,ve)):M("",!0)],2))),128))]))),128))])):(n(),d("div",pe,[s(R,{data:e.scheduleList,border:"",style:{width:"100%"}},{default:t(()=>[s(m,{label:"课程名称",prop:"courseName"}),s(m,{label:"星期",prop:"weekday"},{default:t(l=>[u(i(e.formatWeekday(l.row.weekday)),1)]),_:1}),s(m,{label:"开始时间",prop:"startTime"}),s(m,{label:"结束时间",prop:"endTime"}),s(m,{label:"教室",prop:"classroom"}),s(m,{label:"班级",prop:"className"}),s(m,{label:"操作",width:"100"},{default:t(l=>[s(y,{size:"small",type:"primary",onClick:f=>e.showCourseDetail(l.row)},{default:t(()=>o[8]||(o[8]=[u(" 详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]))]),_:1})),[[x,e.loadingSchedule||e.loadingTimeSlots||e.loadingWeekdays]]),s(N,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[3]||(o[3]=l=>e.dialogVisible=l),title:"课程详情",width:"500px"},{footer:t(()=>[_("span",be,[s(y,{onClick:o[2]||(o[2]=l=>e.dialogVisible=!1)},{default:t(()=>o[9]||(o[9]=[u("关闭")])),_:1})])]),default:t(()=>[e.currentCourse?(n(),A(V,{key:0,column:1,border:"",title:""},{default:t(()=>[s(C,{label:"课程名称"},{default:t(()=>[u(i(e.currentCourse.courseName),1)]),_:1}),s(C,{label:"上课时间"},{default:t(()=>[u(i(e.formatWeekday(e.currentCourse.weekday))+" "+i(e.currentCourse.startTime)+" - "+i(e.currentCourse.endTime),1)]),_:1}),s(C,{label:"上课地点"},{default:t(()=>[u(i(e.currentCourse.classroom),1)]),_:1}),s(C,{label:"学分"},{default:t(()=>[u(i(e.currentCourse.credit),1)]),_:1}),s(C,{label:"授课班级"},{default:t(()=>[u(i(e.currentCourse.className),1)]),_:1})]),_:1})):M("",!0)]),_:1},8,["modelValue"])])}const Ie=X(ne,[["render",ke],["__scopeId","data-v-287d1ac5"]]);export{Ie as default};
