import{_ as R,r as o,o as U,d as $,e as k,f as t,w as r,y as A,z as T,A as I,m as s,B as G,C as p,v as E,F as N,x as C,aL as O,aM as j,G as H,H as Y,a2 as q,h as z,aN as J,g as K,N as Q,P as n,af as W}from"./index-D-KotFfR.js";import{b as X,c as Z,d as ee,u as ae,e as le}from"./course-DKE-dNb-.js";import{C as se}from"./CourseForm-W1_CZKu4.js";import"./request-D0VF7A5d.js";import"./common-BBGhIV1Q.js";const te={class:"teacher-course-management-container"},oe={class:"header"},re={class:"dialog-footer"},ne={__name:"TeacherCourseManagement",setup(ie){const v=o(!1),V=o(!1),w=o(!1),g=o([]),f=o(0),i=o(1),y=o(10);dialogVisible=o(!1);const u=o(!1),h=o({}),b=o(null),m=async()=>{v.value=!0;try{const a={page:i.value,size:y.value},e=await X(a);e.code===200&&e.data?(g.value=e.data.records||[],f.value=e.data.total||0):(n.error(e.message||"获取课程列表失败"),g.value=[],f.value=0)}catch(a){console.error("获取教师课程失败:",a),n.error("获取课程列表时发生错误"),g.value=[],f.value=0}finally{v.value=!1}},B=a=>({COMPULSORY:"必修课",ELECTIVE:"选修课",GENERAL:"通识课"})[a]||a,M=a=>{y.value=a,i.value=1,m()},D=a=>{i.value=a,m()},x=()=>{u.value=!1,h.value={},dialogVisible.value=!0},L=async a=>{u.value=!0,V.value=!0,dialogVisible.value=!0;try{const e=await Z(a.id);e.code===200?h.value=e.data:(n.error(e.message||"获取课程详情失败"),dialogVisible.value=!1)}catch(e){console.error("获取课程详情失败:",e),n.error("获取课程详情失败"),dialogVisible.value=!1}finally{V.value=!1}},S=a=>{W.confirm(`确定要删除课程 "${a.courseName}" 吗?`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,d;try{v.value=!0,await ee(a.id),n.success("删除成功"),g.value.length===1&&i.value>1&&i.value--,m()}catch(l){console.error("删除课程失败:",l),n.error(((d=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:d.message)||"删除失败"),v.value=!1}}).catch(()=>{})},F=()=>{var a;(a=b.value)==null||a.resetForm(),h.value={}},P=async()=>{var a,e,d,l;try{if(!await((a=b.value)==null?void 0:a.validate()))return;w.value=!0;const _=(e=b.value)==null?void 0:e.getFormData();u.value?(await ae(_.id,_),n.success("更新成功")):(await le(_),n.success("添加成功")),dialogVisible.value=!1,m()}catch(c){console.error("提交课程失败:",c),n.error(((l=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:l.message)||(u.value?"更新失败":"添加失败"))}finally{w.value=!1}};return U(()=>{m()}),(a,e)=>{const d=Y;return k(),$("div",te,[t(s(K),{class:"page-container"},{header:r(()=>[z("div",oe,[e[5]||(e[5]=z("span",null,"我教授的课程",-1)),t(s(C),{icon:s(J),type:"primary",onClick:x},{default:r(()=>e[4]||(e[4]=[E("添加课程")])),_:1},8,["icon"])])]),default:r(()=>[A((k(),T(s(G),{data:g.value,style:{width:"100%"}},{empty:r(()=>[t(s(H),{description:"暂无课程数据"})]),default:r(()=>[t(s(p),{label:"课程名称",prop:"courseName"}),t(s(p),{label:"课程编号",prop:"courseNo"}),t(s(p),{label:"学分",prop:"credits",width:"80"}),t(s(p),{label:"课程类型",prop:"courseType",width:"100"},{default:r(l=>[E(N(B(l.row.courseType)),1)]),_:1}),t(s(p),{label:"所属学院",prop:"collegeName"}),t(s(p),{label:"操作",width:"150"},{default:r(l=>[t(s(C),{icon:s(O),circle:"",size:"small",type:"primary",onClick:c=>L(l.row)},null,8,["icon","onClick"]),t(s(C),{icon:s(j),circle:"",size:"small",type:"danger",onClick:c=>S(l.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[d,v.value]]),f.value>0?(k(),T(s(q),{key:0,"current-page":i.value,"onUpdate:currentPage":e[0]||(e[0]=l=>i.value=l),"page-size":y.value,"onUpdate:pageSize":e[1]||(e[1]=l=>y.value=l),"page-sizes":[10,20,50],total:f.value,class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:D},null,8,["current-page","page-size","total"])):I("",!0)]),_:1}),t(s(Q),{modelValue:a.dialogVisible,"onUpdate:modelValue":e[3]||(e[3]=l=>a.dialogVisible=l),title:u.value?"编辑课程":"添加课程",width:"600px",onClose:F},{footer:r(()=>[z("span",re,[t(s(C),{onClick:e[2]||(e[2]=l=>a.dialogVisible=!1)},{default:r(()=>e[6]||(e[6]=[E("取消")])),_:1}),t(s(C),{loading:w.value,type:"primary",onClick:P},{default:r(()=>[E(N(u.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:r(()=>[t(se,{ref_key:"courseFormRef",ref:b,courseData:h.value,isEdit:u.value,loading:V.value},null,8,["courseData","isEdit","loading"])]),_:1},8,["modelValue","title"])])}}},ge=R(ne,[["__scopeId","data-v-30b4675e"]]);export{ge as default};
