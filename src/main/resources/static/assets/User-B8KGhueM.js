import{_ as Y,r as i,a as A,c as Z,o as ee,d as B,e as k,h as S,f as l,w as r,v as m,m as a,l as ae,aT as le,x as v,i as F,aP as te,j as o,k as y,T as _,U as p,g as I,y as se,A as P,z as D,B as re,C as f,D as ue,F as oe,aU as M,H as ne,a2 as de,N as ie,P as d,af as R}from"./index-gQMZQ2sp.js";/* empty css                   */import{b as me,c as pe,r as ve,d as fe,e as ce,f as ge}from"./user-xlhqAG_R.js";import"./request-DfavLRg_.js";import"./api-endpoints-Ctc2JoQP.js";const we={class:"user-management-container"},be={class:"page-header"},ye={key:0,class:"pagination-container"},Ve={class:"dialog-footer"},he={name:"UserManagement"},Ue=Object.assign(he,{setup(Ce){const x=i(!1),$=i([]),T=i(0),c=i(1),h=i(10),n=A({keyword:"",role:"",status:null}),g=i(!1),E=i("添加用户"),U=i(null),u=i({id:null,username:"",password:"",realName:"",userType:"",email:"",phone:"",status:"Active"}),C=Z(()=>!!u.value.id),q=A({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!C.value,message:"请输入初始密码",trigger:"blur"},{min:6,message:"密码长度至少为 6 位",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],userType:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}]}),w=async()=>{x.value=!0;try{const s={page:c.value,size:h.value,keyword:n.keyword||null,role:n.role||null,status:n.status},e=await me(s);$.value=e.data.rows||[],T.value=e.data.total||0}catch(s){console.error("获取用户列表失败",s),d.error("获取用户列表失败")}finally{x.value=!1}},N=()=>{c.value=1,w()},j=s=>{h.value=s,c.value=1,w()},L=s=>{c.value=s,w()},z=()=>{U.value&&U.value.resetFields(),u.value={id:null,username:"",password:"",realName:"",userType:"",email:"",phone:"",status:"Active"}},O=()=>{E.value="添加用户",z(),g.value=!0},H=s=>{E.value="编辑用户",u.value={...s,password:""},g.value=!0},G=s=>{if(s.username==="admin"){d.warning("不能删除超级管理员账号");return}R.confirm(`确定要删除用户 ${s.realName} (${s.username}) 吗? 此操作不可恢复。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await fe(s.id),d.success("用户删除成功"),await w()}catch(e){console.error("删除用户失败",e)}}).catch(()=>{d.info("已取消删除")})},J=s=>{R.confirm(`确定要重置用户 ${s.realName} (${s.username}) 的密码吗? 新密码将是默认密码（例如 '123456'）。`,"提示",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ve(s.id),d.success(`用户 ${s.username} 的密码已重置`)}catch(e){console.error(`重置用户 ${s.username} 密码失败`,e)}}).catch(()=>{d.info("已取消重置密码")})},K=async s=>{const e=s.status,b=e==="Active"?"启用":"禁用";try{await pe(s.id,e),d.success(`${b}成功`)}catch(t){console.error(`更新用户状态失败 (ID: ${s.id})`,t),d.error(`${b}失败`),s.status=e==="Active"?"Inactive":"Active"}},Q=()=>{U.value.validate(async s=>{if(s)try{if(C.value){const{password:e,id:b,...t}=u.value;await ce(b,t),d.success("用户信息更新成功")}else await ge(u.value),d.success("用户添加成功");g.value=!1,await w()}catch(e){console.error("提交用户表单失败",e)}else return console.log("表单验证失败"),!1})},W=s=>s==="Admin"?"管理员":s==="Teacher"?"教师":s==="Student"?"学生":s||"未知",X=s=>s==="Admin"?"danger":s==="Teacher"?"success":s==="Student"?"":"info";return ee(()=>{w()}),(s,e)=>{const b=ne;return k(),B("div",we,[S("div",be,[e[15]||(e[15]=S("h2",null,"用户管理",-1)),l(a(v),{type:"primary",onClick:O},{default:r(()=>[l(a(ae),null,{default:r(()=>[l(a(le))]),_:1}),e[14]||(e[14]=m(" 添加用户 "))]),_:1})]),l(a(I),{class:"filter-card"},{default:r(()=>[l(a(F),{inline:!0,model:n,onSubmit:te(N,["prevent"])},{default:r(()=>[l(a(o),{label:"关键词"},{default:r(()=>[l(a(y),{modelValue:n.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>n.keyword=t),clearable:"",placeholder:"用户名/姓名/邮箱/手机号",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),l(a(o),{label:"角色"},{default:r(()=>[l(a(_),{modelValue:n.role,"onUpdate:modelValue":e[1]||(e[1]=t=>n.role=t),clearable:"",placeholder:"选择角色",style:{width:"150px"}},{default:r(()=>[l(a(p),{label:"管理员",value:"admin"}),l(a(p),{label:"教师",value:"teacher"}),l(a(p),{label:"学生",value:"student"})]),_:1},8,["modelValue"])]),_:1}),l(a(o),{label:"状态"},{default:r(()=>[l(a(_),{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=t=>n.status=t),clearable:"",placeholder:"选择状态",style:{width:"120px"}},{default:r(()=>[l(a(p),{value:1,label:"正常"}),l(a(p),{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),l(a(o),null,{default:r(()=>[l(a(v),{type:"primary",onClick:N},{default:r(()=>e[16]||(e[16]=[m("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(I),{class:"user-list-card"},{default:r(()=>[se((k(),D(a(re),{data:$.value,style:{width:"100%"}},{default:r(()=>[l(a(f),{label:"用户名","min-width":"120",prop:"username"}),l(a(f),{label:"姓名",prop:"realName",width:"120"}),l(a(f),{label:"角色",prop:"userType",width:"100"},{default:r(t=>[l(a(ue),{type:X(t.row.userType)},{default:r(()=>[m(oe(W(t.row.userType)),1)]),_:2},1032,["type"])]),_:1}),l(a(f),{label:"邮箱","min-width":"180",prop:"email"}),l(a(f),{label:"手机号",prop:"phone",width:"150"}),l(a(f),{label:"状态",prop:"status",width:"100"},{default:r(t=>[l(a(M),{modelValue:t.row.status,"onUpdate:modelValue":V=>t.row.status=V,"active-value":"Active","inactive-value":"Inactive",onChange:V=>K(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(a(f),{fixed:"right",label:"操作",width:"200"},{default:r(t=>[l(a(v),{size:"small",type:"primary",onClick:V=>H(t.row)},{default:r(()=>e[17]||(e[17]=[m("编辑")])),_:2},1032,["onClick"]),l(a(v),{size:"small",type:"warning",onClick:V=>J(t.row)},{default:r(()=>e[18]||(e[18]=[m("重置密码")])),_:2},1032,["onClick"]),l(a(v),{disabled:t.row.username==="admin",size:"small",type:"danger",onClick:V=>G(t.row)},{default:r(()=>e[19]||(e[19]=[m("删除 ")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[b,x.value]]),T.value>0?(k(),B("div",ye,[l(a(de),{"current-page":c.value,"onUpdate:currentPage":e[3]||(e[3]=t=>c.value=t),"page-size":h.value,"onUpdate:pageSize":e[4]||(e[4]=t=>h.value=t),"page-sizes":[10,20,50,100],total:T.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:L},null,8,["current-page","page-size","total"])])):P("",!0)]),_:1}),l(a(ie),{modelValue:g.value,"onUpdate:modelValue":e[13]||(e[13]=t=>g.value=t),"close-on-click-modal":!1,title:E.value,width:"600px",onClose:z},{footer:r(()=>[S("span",Ve,[l(a(v),{onClick:e[12]||(e[12]=t=>g.value=!1)},{default:r(()=>e[20]||(e[20]=[m("取消")])),_:1}),l(a(v),{type:"primary",onClick:Q},{default:r(()=>e[21]||(e[21]=[m("确定")])),_:1})])]),default:r(()=>[l(a(F),{ref_key:"userFormRef",ref:U,model:u.value,rules:q,"label-width":"100px"},{default:r(()=>[l(a(o),{label:"用户名",prop:"username"},{default:r(()=>[l(a(y),{modelValue:u.value.username,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.username=t),disabled:C.value,placeholder:"请输入用户名"},null,8,["modelValue","disabled"])]),_:1}),C.value?P("",!0):(k(),D(a(o),{key:0,label:"密码",prop:"password"},{default:r(()=>[l(a(y),{modelValue:u.value.password,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.password=t),placeholder:"请输入初始密码","show-password":"",type:"password"},null,8,["modelValue"])]),_:1})),l(a(o),{label:"姓名",prop:"realName"},{default:r(()=>[l(a(y),{modelValue:u.value.realName,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.realName=t),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(a(o),{label:"角色",prop:"userType"},{default:r(()=>[l(a(_),{modelValue:u.value.userType,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.userType=t),placeholder:"请选择角色"},{default:r(()=>[l(a(p),{label:"管理员",value:"Admin"}),l(a(p),{label:"教师",value:"Teacher"}),l(a(p),{label:"学生",value:"Student"})]),_:1},8,["modelValue"])]),_:1}),l(a(o),{label:"邮箱",prop:"email"},{default:r(()=>[l(a(y),{modelValue:u.value.email,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(a(o),{label:"手机号",prop:"phone"},{default:r(()=>[l(a(y),{modelValue:u.value.phone,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(a(o),{label:"状态",prop:"status"},{default:r(()=>[l(a(M),{modelValue:u.value.status,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.status=t),"active-value":"Active","inactive-value":"Inactive","active-text":"正常","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),_e=Y(Ue,[["__scopeId","data-v-222de3bd"]]);export{_e as default};
