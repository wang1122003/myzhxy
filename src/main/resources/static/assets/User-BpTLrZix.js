import{_ as ee,r as i,a as B,c as ae,o as le,d as F,e as x,h as N,f as l,w as r,v as m,m as a,l as te,aQ as se,x as v,i as R,aM as re,j as o,k as y,T as S,U as p,g as I,y as ue,A as D,z as M,aY as oe,C as f,D as ne,F as de,aZ as P,H as ie,a2 as me,N as pe,P as d,af as q}from"./index-DrN7HJWs.js";import{c as ve,d as j,r as fe,e as ce,f as ge}from"./user-BjEgjqEk.js";import"./request-BGbcGZqw.js";const we={class:"user-management-container"},be={class:"page-header"},ye={key:0,class:"pagination-container"},Ve={class:"dialog-footer"},he={name:"UserManagement"},Ue=Object.assign(he,{setup(Ce){const _=i(!1),$=i([]),T=i(0),c=i(1),U=i(10),n=B({keyword:"",role:"",status:null}),g=i(!1),E=i("添加用户"),C=i(null),u=i({id:null,username:"",password:"",realName:"",userType:"",email:"",phone:"",status:"Active"}),k=ae(()=>!!u.value.id),L=B({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!k.value,message:"请输入初始密码",trigger:"blur"},{min:6,message:"密码长度至少为 6 位",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],userType:[{required:!0,message:"请选择角色",trigger:"change"}],email:[formRules.required,formRules.email],phone:[formRules.required,formRules.phone]}),w=async()=>{_.value=!0;try{const s={page:c.value,size:U.value,keyword:n.keyword||null,role:n.role||null,status:n.status},e=await ve(s);$.value=e.data.rows||[],T.value=e.data.total||0}catch(s){console.error("获取用户列表失败",s),d.error("获取用户列表失败")}finally{_.value=!1}},z=()=>{c.value=1,w()},O=s=>{U.value=s,c.value=1,w()},H=s=>{c.value=s,w()},A=()=>{C.value&&C.value.resetFields(),u.value={id:null,username:"",password:"",realName:"",userType:"",email:"",phone:"",status:"Active"}},Q=()=>{E.value="添加用户",A(),g.value=!0},Y=s=>{E.value="编辑用户",u.value={...s,password:""},g.value=!0},Z=s=>{if(s.username==="admin"){d.warning("不能删除超级管理员账号");return}q.confirm(`确定要删除用户 ${s.realName} (${s.username}) 吗? 此操作不可恢复。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ce(s.id),d.success("用户删除成功"),await w()}catch(e){console.error("删除用户失败",e)}}).catch(()=>{d.info("已取消删除")})},G=s=>{q.confirm(`确定要重置用户 ${s.realName} (${s.username}) 的密码吗? 新密码将是默认密码（例如 '123456'）。`,"提示",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await fe(s.id),d.success(`用户 ${s.username} 的密码已重置`)}catch(e){console.error(`重置用户 ${s.username} 密码失败`,e)}}).catch(()=>{d.info("已取消重置密码")})},J=async s=>{const e=s.status,b=e==="Active"?"启用":"禁用";try{await j(s.id,{status:e}),d.success(`${b}成功`)}catch(V){console.error(`更新用户状态失败 (ID: ${s.id})`,V),d.error(`${b}失败`),s.status=e==="Active"?"Inactive":"Active"}},K=()=>{C.value.validate(async s=>{if(s)try{if(k.value){const{password:e,id:b,...V}=u.value;await j(b,V),d.success("用户信息更新成功")}else await ge(u.value),d.success("用户添加成功");g.value=!1,await w()}catch(e){console.error("提交用户表单失败",e)}else return console.log("表单验证失败"),!1})},W=s=>s==="Admin"?"管理员":s==="Teacher"?"教师":s==="Student"?"学生":s||"未知",X=s=>s==="Admin"?"danger":s==="Teacher"?"success":"info";return le(()=>{w()}),(s,e)=>{const b=oe,V=ie;return x(),F("div",we,[N("div",be,[e[15]||(e[15]=N("h2",null,"用户管理",-1)),l(a(v),{type:"primary",onClick:Q},{default:r(()=>[l(a(te),null,{default:r(()=>[l(a(se))]),_:1}),e[14]||(e[14]=m(" 添加用户 "))]),_:1})]),l(a(I),{class:"filter-card"},{default:r(()=>[l(a(R),{inline:!0,model:n,onSubmit:re(z,["prevent"])},{default:r(()=>[l(a(o),{label:"关键词"},{default:r(()=>[l(a(y),{modelValue:n.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>n.keyword=t),clearable:"",placeholder:"用户名/姓名/邮箱/手机号",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),l(a(o),{label:"角色"},{default:r(()=>[l(a(S),{modelValue:n.role,"onUpdate:modelValue":e[1]||(e[1]=t=>n.role=t),clearable:"",placeholder:"选择角色",style:{width:"150px"}},{default:r(()=>[l(a(p),{label:"管理员",value:"admin"}),l(a(p),{label:"教师",value:"teacher"}),l(a(p),{label:"学生",value:"student"})]),_:1},8,["modelValue"])]),_:1}),l(a(o),{label:"状态"},{default:r(()=>[l(a(S),{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=t=>n.status=t),clearable:"",placeholder:"选择状态",style:{width:"120px"}},{default:r(()=>[l(a(p),{value:1,label:"正常"}),l(a(p),{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),l(a(o),null,{default:r(()=>[l(a(v),{type:"primary",onClick:z},{default:r(()=>e[16]||(e[16]=[m("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(I),{class:"user-list-card"},{default:r(()=>[ue((x(),M(b,{"table-data":$.value,style:{width:"100%"}},{default:r(()=>[l(a(f),{label:"用户名","min-width":"120",prop:"username"}),l(a(f),{label:"姓名",prop:"realName",width:"120"}),l(a(f),{label:"角色",prop:"userType",width:"100"},{default:r(t=>[l(a(ne),{type:X(t.row.userType)},{default:r(()=>[m(de(W(t.row.userType)),1)]),_:2},1032,["type"])]),_:1}),l(a(f),{label:"邮箱","min-width":"180",prop:"email"}),l(a(f),{label:"手机号",prop:"phone",width:"150"}),l(a(f),{label:"状态",prop:"status",width:"100"},{default:r(t=>[l(a(P),{modelValue:t.row.status,"onUpdate:modelValue":h=>t.row.status=h,"active-value":"Active","inactive-value":"Inactive",onChange:h=>J(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(a(f),{fixed:"right",label:"操作",width:"200"},{default:r(t=>[l(a(v),{size:"small",type:"primary",onClick:h=>Y(t.row)},{default:r(()=>e[17]||(e[17]=[m("编辑")])),_:2},1032,["onClick"]),l(a(v),{size:"small",type:"warning",onClick:h=>G(t.row)},{default:r(()=>e[18]||(e[18]=[m("重置密码")])),_:2},1032,["onClick"]),l(a(v),{disabled:t.row.username==="admin",size:"small",type:"danger",onClick:h=>Z(t.row)},{default:r(()=>e[19]||(e[19]=[m("删除 ")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["table-data"])),[[V,_.value]]),T.value>0?(x(),F("div",ye,[l(a(me),{"current-page":c.value,"onUpdate:currentPage":e[3]||(e[3]=t=>c.value=t),"page-size":U.value,"onUpdate:pageSize":e[4]||(e[4]=t=>U.value=t),"page-sizes":[10,20,50,100],total:T.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:H},null,8,["current-page","page-size","total"])])):D("",!0)]),_:1}),l(a(pe),{modelValue:g.value,"onUpdate:modelValue":e[13]||(e[13]=t=>g.value=t),"close-on-click-modal":!1,title:E.value,width:"600px",onClose:A},{footer:r(()=>[N("span",Ve,[l(a(v),{onClick:e[12]||(e[12]=t=>g.value=!1)},{default:r(()=>e[20]||(e[20]=[m("取消")])),_:1}),l(a(v),{type:"primary",onClick:K},{default:r(()=>e[21]||(e[21]=[m("确定")])),_:1})])]),default:r(()=>[l(a(R),{ref_key:"userFormRef",ref:C,model:u.value,rules:L,"label-width":"100px"},{default:r(()=>[l(a(o),{label:"用户名",prop:"username"},{default:r(()=>[l(a(y),{modelValue:u.value.username,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.username=t),disabled:k.value,placeholder:"请输入用户名"},null,8,["modelValue","disabled"])]),_:1}),k.value?D("",!0):(x(),M(a(o),{key:0,label:"密码",prop:"password"},{default:r(()=>[l(a(y),{modelValue:u.value.password,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.password=t),placeholder:"请输入初始密码","show-password":"",type:"password"},null,8,["modelValue"])]),_:1})),l(a(o),{label:"姓名",prop:"realName"},{default:r(()=>[l(a(y),{modelValue:u.value.realName,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.realName=t),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(a(o),{label:"角色",prop:"userType"},{default:r(()=>[l(a(S),{modelValue:u.value.userType,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.userType=t),placeholder:"请选择角色"},{default:r(()=>[l(a(p),{label:"管理员",value:"Admin"}),l(a(p),{label:"教师",value:"Teacher"}),l(a(p),{label:"学生",value:"Student"})]),_:1},8,["modelValue"])]),_:1}),l(a(o),{label:"邮箱",prop:"email"},{default:r(()=>[l(a(y),{modelValue:u.value.email,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(a(o),{label:"手机号",prop:"phone"},{default:r(()=>[l(a(y),{modelValue:u.value.phone,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(a(o),{label:"状态",prop:"status"},{default:r(()=>[l(a(P),{modelValue:u.value.status,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.status=t),"active-value":"Active","inactive-value":"Inactive","active-text":"正常","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Te=ee(Ue,[["__scopeId","data-v-45e28409"]]);export{Te as default};
