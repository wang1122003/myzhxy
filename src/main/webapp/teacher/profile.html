<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人资料 - 教师中心</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 30px;
            margin-bottom: 30px;
        }
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 20px;
            border: 4px solid #f8f9fa;
        }
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-info {
            flex: 1;
        }
        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .profile-id {
            color: #6c757d;
            margin-bottom: 10px;
        }
        .profile-detail {
            margin-top: 30px;
        }
        .detail-item {
            margin-bottom: 20px;
        }
        .detail-item-label {
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .detail-item-value {
            font-size: 16px;
        }
        .profile-actions {
            margin-top: 30px;
            display: flex;
            justify-content: flex-end;
        }
        .profile-section {
            margin-bottom: 30px;
        }
        .profile-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .stats-item {
            flex: 1;
            min-width: 200px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 0 10px 20px;
            text-align: center;
        }
        .stats-value {
            font-size: 28px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .stats-label {
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div id="loading-mask">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">加载中...</span>
        </div>
    </div>

    <header>
        <div class="logo">
            <img src="../static/img/logo.png" alt="校园系统">
            <span>校园系统</span>
        </div>
        <div class="user-menu">
            <div class="user-info">
                <img src="../static/img/avatar.png" alt="用户头像" class="user-avatar">
                <span class="user-name">加载中...</span>
            </div>
            <div class="dropdown-menu">
                <a href="profile.html">个人资料</a>
                <a href="javascript:void(0)" onclick="logout()">退出登录</a>
            </div>
        </div>
    </header>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">
                                <i class="fa fa-home"></i> 首页
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="courses.html">
                                <i class="fa fa-book"></i> 我的课程
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="schedule.html">
                                <i class="fa fa-calendar"></i> 我的课表
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../forum.html">
                                <i class="fa fa-comments"></i> 校园论坛
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="profile.html">
                                <i class="fa fa-user"></i> 个人资料
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-10 ml-sm-auto px-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">个人资料</h1>
                </div>

                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <img src="../static/img/avatar.png" alt="头像" id="teacherAvatar">
                        </div>
                        <div class="profile-info">
                            <div class="profile-name" id="teacherName">加载中...</div>
                            <div class="profile-id">工号: <span id="teacherId">加载中...</span></div>
                            <div class="badge badge-primary">教师</div>
                        </div>
                        <div class="profile-actions">
                            <button id="updateProfileBtn" class="btn btn-primary">
                                <i class="fa fa-edit"></i> 编辑资料
                            </button>
                        </div>
                    </div>

                    <div class="profile-detail">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-item-label">院系</div>
                                    <div class="detail-item-value" id="teacherDepartment">加载中...</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-item-label">职称</div>
                                    <div class="detail-item-value" id="teacherTitle">加载中...</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-item-label">电子邮箱</div>
                                    <div class="detail-item-value" id="teacherEmail">加载中...</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-item-label">手机号码</div>
                                    <div class="detail-item-value" id="teacherPhone">加载中...</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-item-label">入职时间</div>
                                    <div class="detail-item-value" id="teacherJoinDate">加载中...</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <div class="detail-item-label">账号状态</div>
                                    <div class="detail-item-value">
                                        <span class="badge badge-success">正常</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="profile-section">
                    <div class="profile-section-title">教学统计</div>
                    <div class="stats-container">
                        <div class="stats-item">
                            <div class="stats-value" id="courseCount">0</div>
                            <div class="stats-label">授课课程</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value" id="studentCount">0</div>
                            <div class="stats-label">授课学生</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value" id="classHours">0</div>
                            <div class="stats-label">课时数</div>
                        </div>
                    </div>
                </div>

                <div class="profile-section">
                    <div class="profile-section-title">账号安全</div>
                    <div class="list-group">
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">登录密码</h6>
                                <p class="mb-0 text-muted">定期修改密码可以保障账号安全</p>
                            </div>
                            <button class="btn btn-sm btn-outline-secondary" id="changePasswordBtn">修改</button>
                        </div>
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">手机绑定</h6>
                                <p class="mb-0 text-muted">已绑定手机: <span id="bindPhone">138****1234</span></p>
                            </div>
                            <button class="btn btn-sm btn-outline-secondary" id="changePhoneBtn">修改</button>
                        </div>
                        <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">邮箱绑定</h6>
                                <p class="mb-0 text-muted">已绑定邮箱: <span id="bindEmail">t****@example.com</span></p>
                            </div>
                            <button class="btn btn-sm btn-outline-secondary" id="changeEmailBtn">修改</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 编辑资料模态框 -->
    <div class="modal fade" id="updateProfileModal" tabindex="-1" role="dialog" aria-labelledby="updateProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateProfileModalLabel">编辑个人资料</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="form-group">
                            <label for="profileName">姓名</label>
                            <input type="text" class="form-control" id="profileName" placeholder="请输入姓名">
                        </div>
                        <div class="form-group">
                            <label for="profileEmail">电子邮箱</label>
                            <input type="email" class="form-control" id="profileEmail" placeholder="请输入电子邮箱">
                        </div>
                        <div class="form-group">
                            <label for="profilePhone">手机号码</label>
                            <input type="tel" class="form-control" id="profilePhone" placeholder="请输入手机号码">
                        </div>
                        <div class="form-group">
                            <label for="profileAvatar">头像</label>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="profileAvatar">
                                <label class="custom-file-label" for="profileAvatar">选择图片</label>
                            </div>
                            <small class="form-text text-muted">支持JPG、PNG格式，不超过2MB</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveProfileBtn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改密码模态框 -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">修改密码</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="passwordForm">
                        <div class="form-group">
                            <label for="currentPassword">当前密码</label>
                            <input type="password" class="form-control" id="currentPassword" placeholder="请输入当前密码">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">新密码</label>
                            <input type="password" class="form-control" id="newPassword" placeholder="请输入新密码">
                            <small class="form-text text-muted">密码长度8-20位，包含字母和数字</small>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">确认密码</label>
                            <input type="password" class="form-control" id="confirmPassword" placeholder="请再次输入新密码">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="savePasswordBtn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/api.js"></script>
    <script src="../static/js/teacherUI.js"></script>
    <script>
        $(document).ready(function() {
            // 初始化用户信息
            var userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
            $('.user-name').text(userInfo.name || '教师');
            
            // 用户菜单交互
            $('.user-info').click(function(e) {
                e.stopPropagation();
                $('.dropdown-menu').toggleClass('show');
            });
            
            $(document).click(function() {
                $('.dropdown-menu').removeClass('show');
            });

            // 加载教师资料
            loadTeacherProfile();
            
            // 绑定编辑资料按钮事件
            $('#updateProfileBtn').on('click', function() {
                showUpdateProfileModal();
            });
            
            // 绑定修改密码按钮事件
            $('#changePasswordBtn').on('click', function() {
                showChangePasswordModal();
            });
            
            // 绑定自定义文件输入框事件
            $('#profileAvatar').on('change', function() {
                var fileName = $(this).val().split('\\').pop();
                $(this).next('.custom-file-label').html(fileName || '选择图片');
            });
        });
        
        // 加载教师资料
        function loadTeacherProfile() {
            // 移除loading-mask
            $('#loading-mask').hide();
            
            // 模拟加载个人资料数据
            const mockProfile = {
                id: "T2023001",
                name: "张教授",
                department: "计算机科学与技术学院",
                title: "教授",
                email: "teacher@example.com",
                phone: "13800138000",
                joinDate: "2018-09-01",
                stats: {
                    courseCount: 5,
                    studentCount: 210,
                    classHours: 320
                }
            };
            
            // 填充个人资料数据
            $('#teacherName').text(mockProfile.name);
            $('#teacherId').text(mockProfile.id);
            $('#teacherDepartment').text(mockProfile.department);
            $('#teacherTitle').text(mockProfile.title);
            $('#teacherEmail').text(mockProfile.email);
            $('#teacherPhone').text(mockProfile.phone);
            $('#teacherJoinDate').text(mockProfile.joinDate);
            
            // 填充统计数据
            $('#courseCount').text(mockProfile.stats.courseCount);
            $('#studentCount').text(mockProfile.stats.studentCount);
            $('#classHours').text(mockProfile.stats.classHours);
            
            // 填充绑定信息
            if (mockProfile.phone) {
                const maskedPhone = maskPhoneNumber(mockProfile.phone);
                $('#bindPhone').text(maskedPhone);
            }
            
            if (mockProfile.email) {
                const maskedEmail = maskEmail(mockProfile.email);
                $('#bindEmail').text(maskedEmail);
            }
        }
        
        // 显示更新个人资料模态框
        function showUpdateProfileModal() {
            const userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
            
            // 填充表单
            $('#profileName').val(userInfo.name || '');
            $('#profileEmail').val(userInfo.email || '');
            $('#profilePhone').val(userInfo.phone || '');
            
            $('#updateProfileModal').modal('show');
            
            // 绑定保存按钮事件
            $('#saveProfileBtn').off('click').on('click', function() {
                const profileData = {
                    name: $('#profileName').val(),
                    email: $('#profileEmail').val(),
                    phone: $('#profilePhone').val()
                };
                
                // 模拟保存个人资料
                setTimeout(function() {
                    // 更新本地存储的用户信息
                    const userInfo = JSON.parse(localStorage.getItem('userInfo')) || {};
                    userInfo.name = profileData.name;
                    userInfo.email = profileData.email;
                    userInfo.phone = profileData.phone;
                    localStorage.setItem('userInfo', JSON.stringify(userInfo));
                    
                    // 更新界面
                    $('.user-name').text(profileData.name);
                    $('#teacherName').text(profileData.name);
                    $('#teacherEmail').text(profileData.email);
                    $('#teacherPhone').text(profileData.phone);
                    
                    // 更新绑定信息
                    if (profileData.phone) {
                        const maskedPhone = maskPhoneNumber(profileData.phone);
                        $('#bindPhone').text(maskedPhone);
                    }
                    
                    if (profileData.email) {
                        const maskedEmail = maskEmail(profileData.email);
                        $('#bindEmail').text(maskedEmail);
                    }
                    
                    $('#updateProfileModal').modal('hide');
                    showMessage('个人资料更新成功');
                }, 500);
            });
        }
        
        // 显示修改密码模态框
        function showChangePasswordModal() {
            // 重置表单
            $('#passwordForm')[0].reset();
            
            $('#changePasswordModal').modal('show');
            
            // 绑定保存按钮事件
            $('#savePasswordBtn').off('click').on('click', function() {
                const currentPassword = $('#currentPassword').val();
                const newPassword = $('#newPassword').val();
                const confirmPassword = $('#confirmPassword').val();
                
                // 简单校验
                if (!currentPassword) {
                    showMessage('请输入当前密码', 'danger');
                    return;
                }
                
                if (!newPassword) {
                    showMessage('请输入新密码', 'danger');
                    return;
                }
                
                if (newPassword.length < 8) {
                    showMessage('新密码长度不能小于8位', 'danger');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showMessage('两次输入的密码不一致', 'danger');
                    return;
                }
                
                // 模拟修改密码
                setTimeout(function() {
                    $('#changePasswordModal').modal('hide');
                    showMessage('密码修改成功');
                }, 500);
            });
        }
        
        // 显示消息
        function showMessage(message, type = 'success') {
            const alertClass = 'alert-' + (type || 'success');
            const alertHtml = '<div class="alert ' + alertClass + ' alert-dismissible fade show" role="alert">' + 
                               message + 
                               '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                               '<span aria-hidden="true">&times;</span></button></div>';
            
            const alertElement = $(alertHtml);
            $('main').prepend(alertElement);
            
            // 3秒后自动关闭
            setTimeout(function() {
                alertElement.alert('close');
            }, 3000);
        }
        
        // 手机号码脱敏
        function maskPhoneNumber(phone) {
            if (!phone) return '';
            return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
        }
        
        // 邮箱脱敏
        function maskEmail(email) {
            if (!email) return '';
            const parts = email.split('@');
            if (parts.length !== 2) return email;
            
            let username = parts[0];
            const domain = parts[1];
            
            if (username.length <= 1) {
                return username + '****@' + domain;
            } else {
                return username.charAt(0) + '****@' + domain;
            }
        }
        
        // 退出登录
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                localStorage.removeItem('token');
                localStorage.removeItem('userInfo');
                window.location.href = '../index.html';
            }
        }
    </script>
</body>
</html> 